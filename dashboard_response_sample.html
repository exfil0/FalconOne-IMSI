
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FalconOne Dashboard v1.7</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ==================== ADVANCED DESIGN SYSTEM ==================== */
        :root {
            --sidebar-width: 260px;
            --header-height: 60px;
            --primary-blue: #0d47a1;
            --primary-blue-light: #1565c0;
            --primary-blue-dark: #002171;
            --accent-cyan: #00e5ff;
            --accent-green: #00e676;
            --accent-purple: #7c4dff;
            --success: #00e676;
            --warning: #ffab00;
            --danger: #ff1744;
            --info: #00b0ff;
            --bg-dark: #0a0e27;
            --bg-sidebar: #0f1419;
            --bg-panel: #141c3a;
            --bg-panel-hover: #1a2449;
            --bg-header: linear-gradient(135deg, #0d47a1 0%, #1565c0 100%);
            --text-primary: #e8eaed;
            --text-secondary: #9aa0a6;
            --text-muted: #5f6368;
            --border-color: #2a3f5f;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.3);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.4);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.5);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --glow: 0 0 20px rgba(0, 229, 255, 0.3);
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.6;
            font-size: 14px;
            display: flex;
            min-height: 100vh;
        }
        
        /* ==================== HEADER & NAVIGATION ==================== */
        .header { 
            background: linear-gradient(135deg, var(--primary-blue-dark) 0%, var(--primary-blue) 50%, var(--primary-blue-light) 100%);
            padding: 20px 30px;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 2px solid var(--accent-cyan);
        }
        
        .header h1 { 
            font-size: 28px;
            margin-bottom: 8px;
            font-weight: 700;
            letter-spacing: -0.5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .header p { 
            font-size: 13px;
            opacity: 0.9;
            font-weight: 400;
            letter-spacing: 0.3px;
        }
        
        .nav-tabs { 
            display: flex;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .nav-tab { 
            padding: 10px 18px;
            background: rgba(255,255,255,0.08);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 13px;
            font-weight: 500;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            user-select: none;
        }
        
        .nav-tab:hover { 
            background: rgba(255,255,255,0.15);
            border-color: var(--accent-cyan);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,229,255,0.2);
        }
        
        .nav-tab.active { 
            background: rgba(0,229,255,0.2);
            border-color: var(--accent-cyan);
            font-weight: 600;
            box-shadow: 0 0 20px rgba(0,229,255,0.3);
        }
        
        /* ==================== CONTAINER & PANELS ==================== */
        .container { 
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 20px;
            padding: 25px;
            max-width: 2400px;
            margin: 0 auto;
        }
        
        /* Container responsive rules moved to main responsive section */
        
        .panel { 
            background: var(--bg-panel);
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-blue), var(--accent-cyan));
            opacity: 0;
            transition: var(--transition);
        }
        
        .panel:hover {
            border-color: var(--accent-cyan-light);
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        
        .panel:hover::before {
            opacity: 1;
        }
        
        .panel h2 { 
            font-size: 18px;
            margin-bottom: 18px;
            color: var(--accent-cyan-light);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            font-weight: 600;
            letter-spacing: 0.3px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel-large { 
            grid-column: span 2;
        }
        
        /* Panel-large responsive rules moved to main responsive section */
        
        /* ==================== COMPONENTS ==================== */
        #map { 
            height: 400px;
            border-radius: 10px;
            border: 2px solid var(--border-color);
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .kpi { 
            display: inline-block;
            margin: 10px;
            padding: 16px 20px;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-light));
            border-radius: 10px;
            box-shadow: var(--shadow-md);
            min-width: 160px;
            transition: var(--transition);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .kpi:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(13,71,161,0.4);
        }
        
        .kpi-label { 
            font-size: 11px;
            opacity: 0.85;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }
        
        .kpi-value { 
            font-size: 26px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .alert { 
            background: linear-gradient(135deg, rgba(211,47,47,0.9), rgba(198,40,40,0.9));
            padding: 14px 16px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid var(--danger);
            box-shadow: var(--shadow-sm);
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .alert.low { 
            background: linear-gradient(135deg, rgba(251,192,45,0.9), rgba(249,168,37,0.9));
            border-left-color: #fdd835;
        }
        
        .alert.medium { 
            background: linear-gradient(135deg, rgba(255,111,0,0.9), rgba(245,124,0,0.9));
            border-left-color: #ff9100;
        }
        
        .chart-container { 
            position: relative;
            height: 280px;
            margin-top: 18px;
        }
        
        .status-indicator { 
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
            position: relative;
        }
        
        .status-indicator::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0; }
        }
        
        .status-active { 
            background: var(--success);
        }
        
        .status-active::after {
            background: var(--success);
        }
        
        .status-inactive { 
            background: #616161;
        }
        
        .data-table { 
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            margin-top: 12px;
        }
        
        .data-table th { 
            background: var(--primary-blue);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.5px;
        }
        
        .data-table td { 
            padding: 10px 12px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .data-table tr:hover { 
            background: var(--bg-panel-hover);
        }
        
        .data-table tr:last-child td {
            border-bottom: none;
        }
        
        .badge { 
            display: inline-block;
            padding: 5px 12px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 600;
            margin: 3px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .badge-success { background: var(--success); color: #000; }
        .badge-warning { background: var(--warning); color: #000; }
        .badge-danger { background: var(--danger); color: #fff; }
        .badge-info { background: var(--accent-cyan); color: #000; }
        
        .progress-bar { 
            width: 100%;
            height: 24px;
            background: var(--bg-dark);
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .progress-fill { 
            height: 100%;
            background: linear-gradient(90deg, var(--success), #69f0ae);
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            color: #000;
        }
        
        .spectrum-canvas { 
            width: 100%;
            height: 220px;
            background: #000;
            border-radius: 10px;
            border: 2px solid var(--border-color);
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.5);
        }
        
        .filter-controls { 
            display: flex;
            gap: 12px;
            margin-bottom: 18px;
            flex-wrap: wrap;
        }
        
        .filter-controls select,
        .filter-controls input { 
            padding: 10px 14px;
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 8px;
            transition: var(--transition);
            font-size: 13px;
        }
        
        .filter-controls select:focus,
        .filter-controls input:focus {
            outline: none;
            border-color: var(--accent-cyan);
            box-shadow: 0 0 0 3px rgba(0,229,255,0.1);
        }
        
        .btn { 
            padding: 10px 20px;
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: var(--shadow-sm);
        }
        
        .btn:hover { 
            background: var(--primary-blue-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .tab-content { 
            display: none;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .tab-content.active { 
            display: block;
        }
        
        /* ==================== SCROLLBAR ==================== */
        * {
            scrollbar-width: thin;
            scrollbar-color: var(--primary-blue) var(--bg-dark);
        }
        
        ::-webkit-scrollbar { 
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track { 
            background: var(--bg-dark);
        }
        
        ::-webkit-scrollbar-thumb { 
            background: var(--primary-blue);
            border-radius: 6px;
            border: 2px solid var(--bg-dark);
        }
        
        ::-webkit-scrollbar-thumb:hover { 
            background: var(--primary-blue-light);
        }
        
        /* ==================== LOADING INDICATORS ==================== */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: var(--accent-cyan);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ==================== TABLES ==================== */
        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-dark);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow-medium);
        }
        
        thead {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
        }
        
        th {
            padding: 15px 20px;
            text-align: left;
            font-weight: 600;
            color: #fff;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        td {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
            font-size: 14px;
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        tbody tr {
            transition: background-color 0.2s ease;
        }
        
        tbody tr:hover {
            background: rgba(0,229,255,0.05);
        }
        
        /* ==================== FORMS ==================== */
        input[type="text"],
        input[type="number"],
        input[type="password"],
        select,
        textarea {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s var(--transition-cubic);
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent-cyan);
            box-shadow: 0 0 0 3px rgba(0,229,255,0.1);
        }
        
        input::placeholder {
            color: var(--text-secondary);
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 14px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        /* ==================== ALERTS & BADGES ==================== */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .alert-success {
            background: rgba(76,175,80,0.15);
            border-color: var(--success);
            color: var(--success);
        }
        
        .alert-warning {
            background: rgba(255,152,0,0.15);
            border-color: var(--warning);
            color: var(--warning);
        }
        
        .alert-danger {
            background: rgba(255,23,68,0.15);
            border-color: var(--danger);
            color: var(--danger);
        }
        
        .alert-info {
            background: rgba(0,229,255,0.1);
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
        }
        
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-success {
            background: var(--success);
            color: #000;
        }
        
        .badge-warning {
            background: var(--warning);
            color: #000;
        }
        
        .badge-danger {
            background: var(--danger);
            color: #fff;
        }
        
        .badge-info {
            background: var(--accent-cyan);
            color: #000;
        }
        
        /* ==================== CODE BLOCKS ==================== */
        code, pre {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
        }
        
        code {
            background: #000;
            color: var(--accent-cyan);
            padding: 3px 8px;
            border-radius: 4px;
        }
        
        pre {
            background: #000;
            color: var(--accent-cyan);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid var(--border-color);
        }
        
        /* ==================== PROGRESS BARS ==================== */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-dark);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-blue), var(--accent-cyan));
            border-radius: 10px;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* ==================== MODAL OVERLAY ==================== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            animation: fadeIn 0.2s ease-in;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: var(--bg-primary);
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            border: 2px solid var(--accent-cyan);
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            animation: slideIn 0.3s ease-out;
        }
        
        /* ==================== TOOLTIPS ==================== */
        [data-tooltip] {
            position: relative;
            cursor: help;
        }
        
        [data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 12px;
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            margin-bottom: 8px;
            box-shadow: var(--shadow-md);
        }
        
        [data-tooltip]:hover::after {
            opacity: 1;
        }
        
        /* ==================== LEFT SIDEBAR NAVIGATION ==================== */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--bg-sidebar);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 1100;
            border-right: 1px solid var(--border-color);
            box-shadow: 4px 0 16px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        .sidebar-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-blue-dark), var(--primary-blue));
            border-bottom: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }
        
        .sidebar-header h1 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--accent-cyan);
        }
        
        .sidebar-header p {
            font-size: 11px;
            opacity: 0.7;
            font-weight: 400;
        }
        
        .sidebar-nav {
            flex: 1;
            padding: 10px 0;
        }
        
        .nav-item {
            padding: 14px 20px;
            cursor: pointer;
            transition: var(--transition);
            border-left: 3px solid transparent;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            user-select: none;
            margin: 2px 0;
        }
        
        .nav-item:hover {
            background: var(--bg-panel);
            color: var(--text-primary);
            border-left-color: var(--accent-cyan);
        }
        
        .nav-item.active {
            background: var(--bg-panel);
            color: var(--accent-cyan);
            border-left-color: var(--accent-cyan);
            font-weight: 600;
            box-shadow: inset 0 0 20px rgba(0,229,255,0.1);
        }
        
        .nav-item i {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }
        
        .sidebar-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            font-size: 11px;
            color: var(--text-muted);
        }
        
        .sidebar-footer .status-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            align-items: center;
        }
        
        /* ==================== MAIN CONTENT AREA ==================== */
        .main-content {
            margin-left: var(--sidebar-width);
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .top-header {
            height: var(--header-height);
            background: linear-gradient(135deg, var(--primary-blue-dark), var(--primary-blue));
            border-bottom: 2px solid var(--accent-cyan);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 12px;
        }
        
        .header-right .status-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 16px;
        }
        
        .content-area {
            flex: 1;
            overflow-y: auto;
            background: var(--bg-dark);
        }
        
        /* ==================== RESPONSIVE DESIGN ==================== */
        
        /* Hamburger Menu Button (Mobile Only) */
        .hamburger {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 10002;
            background: var(--bg-sidebar);
            border: 2px solid var(--accent-cyan);
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            width: 45px;
            height: 45px;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 5px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            transition: var(--transition);
        }
        
        .hamburger:hover {
            background: var(--primary-blue);
            box-shadow: 0 0 20px rgba(0,229,255,0.4);
        }
        
        .hamburger span {
            display: block;
            width: 20px;
            height: 2px;
            background: var(--accent-cyan);
            transition: var(--transition);
            border-radius: 2px;
        }
        
        .hamburger.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }
        
        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }
        
        .hamburger.active span:nth-child(3) {
            transform: rotate(-45deg) translate(6px, -6px);
        }
        
        /* Overlay for mobile sidebar */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
            backdrop-filter: blur(4px);
        }
        
        /* ==================== MOBILE DEVICES (< 576px) ==================== */
        @media (max-width: 576px) {
            /* Show hamburger menu */
            .hamburger {
                display: flex;
            }
            
            /* Hide sidebar by default */
            .sidebar {
                position: fixed;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 1000;
                width: 80vw;
                max-width: 280px;
                box-shadow: 5px 0 20px rgba(0,0,0,0.5);
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .sidebar-overlay.active {
                display: block;
            }
            
            /* Remove sidebar margin */
            .main-content {
                margin-left: 0;
                width: 100%;
            }
            
            /* Adjust top header */
            .top-header {
                padding: 12px 15px;
                padding-left: 65px; /* Space for hamburger */
            }
            
            .top-header h1 {
                font-size: 18px;
            }
            
            /* Container adjustments */
            .container {
                grid-template-columns: 1fr;
                padding: 10px;
                gap: 15px;
            }
            
            /* Panel adjustments */
            .panel {
                padding: 15px;
                border-radius: 10px;
            }
            
            .panel h2 {
                font-size: 16px;
            }
            
            .panel-large {
                grid-column: span 1;
            }
            
            /* Device grid */
            .device-grid {
                grid-template-columns: 1fr !important;
            }
            
            /* Buttons */
            .btn {
                padding: 8px 12px;
                font-size: 12px;
                width: 100%;
                margin-bottom: 8px;
            }
            
            /* Status badges */
            .status-badge {
                padding: 4px 8px;
                font-size: 11px;
            }
            
            /* Terminal */
            .terminal-input {
                font-size: 12px;
            }
            
            /* Tables */
            .data-table {
                font-size: 12px;
            }
            
            .data-table th,
            .data-table td {
                padding: 8px 6px;
            }
            
            /* Map */
            #map {
                height: 300px;
            }
            
            /* Sidebar nav items */
            .sidebar-nav-item {
                padding: 12px 15px;
                font-size: 13px;
            }
            
            /* Header badges */
            .header-status {
                flex-wrap: wrap;
                gap: 8px;
            }
        }
        
        /* ==================== TABLETS (577px - 768px) ==================== */
        @media (min-width: 577px) and (max-width: 768px) {
            /* Show hamburger menu */
            .hamburger {
                display: flex;
            }
            
            /* Sidebar behavior */
            .sidebar {
                position: fixed;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 1000;
                width: 260px;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .sidebar-overlay.active {
                display: block;
            }
            
            .main-content {
                margin-left: 0;
                width: 100%;
            }
            
            .top-header {
                padding-left: 65px;
            }
            
            /* 2-column grid */
            .container {
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
                padding: 20px;
            }
            
            .device-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)) !important;
            }
            
            #map {
                height: 350px;
            }
        }
        
        /* ==================== TABLETS LANDSCAPE (769px - 1024px) ==================== */
        @media (min-width: 769px) and (max-width: 1024px) {
            /* Sidebar stays visible but narrower */
            .sidebar {
                width: 220px;
            }
            
            .main-content {
                margin-left: 220px;
            }
            
            .container {
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
                padding: 20px;
            }
            
            .panel-large {
                grid-column: span 2;
            }
            
            .device-grid {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)) !important;
            }
        }
        
        /* ==================== SMALL LAPTOPS (1025px - 1366px) ==================== */
        @media (min-width: 1025px) and (max-width: 1366px) {
            .sidebar {
                width: 240px;
            }
            
            .main-content {
                margin-left: 240px;
            }
            
            .container {
                grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
            }
        }
        
        /* ==================== LARGE SCREENS (1367px - 1920px) ==================== */
        @media (min-width: 1367px) and (max-width: 1920px) {
            .container {
                grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
                max-width: 1800px;
            }
        }
        
        /* ==================== ULTRA-WIDE (> 1920px) ==================== */
        @media (min-width: 1921px) {
            .sidebar {
                width: 280px;
            }
            
            .main-content {
                margin-left: 280px;
            }
            
            .container {
                grid-template-columns: repeat(auto-fit, minmax(420px, 1fr));
                max-width: 2400px;
                gap: 25px;
            }
            
            .panel {
                padding: 28px;
            }
        }
        
        /* ==================== PRINT STYLES ==================== */
        @media print {
            .sidebar,
            .hamburger,
            .sidebar-footer,
            .top-header,
            button,
            .btn {
                display: none !important;
            }
            
            .main-content {
                margin-left: 0;
                width: 100%;
            }
            
            body {
                background: white;
                color: black;
            }
            
            .panel {
                break-inside: avoid;
                page-break-inside: avoid;
            }
        }
        
        /* ==================== DEVICE MANAGER STYLES ==================== */
        .device-card {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            transition: var(--transition);
            position: relative;
        }
        
        .device-card:hover {
            border-color: var(--accent-cyan);
            box-shadow: var(--glow);
            transform: translateY(-2px);
        }
        
        .device-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .device-icon {
            font-size: 32px;
        }
        
        .device-info h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .device-info p {
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        .device-status {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .device-status.online {
            background: rgba(0, 230, 118, 0.2);
            color: var(--success);
        }
        
        .device-status.offline {
            background: rgba(97, 97, 97, 0.2);
            color: #9e9e9e;
        }
        
        .device-status.error {
            background: rgba(255, 23, 68, 0.2);
            color: var(--danger);
        }
        
        .device-capabilities {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin: 10px 0;
        }
        
        .capability-badge {
            font-size: 10px;
            padding: 4px 8px;
            background: rgba(124, 77, 255, 0.2);
            color: var(--accent-purple);
            border-radius: 8px;
            font-weight: 600;
        }
        
        .device-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }
        
        .device-btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 11px;
            transition: var(--transition);
        }
        
        .device-btn.test {
            background: var(--info);
            color: #000;
        }
        
        .device-btn.test:hover {
            background: #29b6f6;
            transform: scale(1.05);
        }
        
        .device-btn.configure {
            background: var(--accent-purple);
            color: #fff;
        }
        
        .device-btn.configure:hover {
            background: #9575cd;
            transform: scale(1.05);
        }
        
        .device-btn.uninstall {
            background: var(--danger);
            color: #fff;
        }
        
        .device-btn.uninstall:hover {
            background: #ff5252;
            transform: scale(1.05);
        }
        
        .device-install-card {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .device-install-card:hover {
            border-color: var(--accent-cyan);
            transform: translateY(-4px);
            box-shadow: var(--glow);
        }
        
        .device-install-card h3 {
            font-size: 16px;
            font-weight: 600;
            margin: 10px 0 5px 0;
        }
        
        .device-install-card p {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* ==================== TERMINAL STYLES ==================== */
        .quick-cmd-btn {
            padding: 8px 16px;
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: var(--transition);
        }
        
        .quick-cmd-btn:hover {
            background: var(--bg-panel-hover);
            border-color: var(--accent-cyan);
            transform: translateY(-2px);
        }
        
        .terminal-line {
            margin: 4px 0;
            line-height: 1.4;
        }
        
        .terminal-prompt {
            color: #0f0;
            font-weight: 600;
        }
        
        .terminal-output {
            color: #0ff;
        }
        
        .terminal-error {
            color: #f00;
        }
        
        .terminal-success {
            color: #0f0;
        }
        
        /* ==================== EXPLOIT MANAGEMENT STYLES ==================== */
        .exploit-controls {
            background: rgba(13, 71, 161, 0.1);
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid rgba(0, 229, 255, 0.2);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--accent-cyan);
            font-weight: 600;
            font-size: 13px;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            color: var(--text-primary);
            font-size: 14px;
            transition: var(--transition);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--accent-cyan);
            box-shadow: 0 0 0 2px rgba(0, 229, 255, 0.2);
        }
        
        .form-control::placeholder {
            color: var(--text-muted);
        }
        
        select.form-control {
            cursor: pointer;
        }
        
        textarea.form-control {
            resize: vertical;
            min-height: 80px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .btn i {
            font-size: 16px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #0d47a1, #1976d2);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #1565c0, #2196f3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #00c853, #00e676);
            color: white;
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #00e676, #69f0ae);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #d32f2f, #f44336);
            color: white;
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #f44336, #e57373);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f57c00, #ff9800);
            color: white;
        }
        
        .btn-warning:hover {
            background: linear-gradient(135deg, #ff9800, #ffb74d);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #0277bd, #03a9f4);
            color: white;
        }
        
        .btn-info:hover {
            background: linear-gradient(135deg, #03a9f4, #4fc3f7);
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        .form-params {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        #active-exploits-summary {
            background: rgba(255, 171, 0, 0.1);
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid var(--warning);
            margin-top: 15px;
        }
        
        .exploit-result-item {
            background: rgba(0, 229, 255, 0.05);
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 3px solid var(--accent-cyan);
        }
        
        .exploit-progress {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .exploit-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00e5ff, #00e676);
            transition: width 0.5s ease;
        }
        
        .param-hint {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 3px;
        }
        
        .required-marker {
            color: var(--danger);
            margin-left: 3px;
        }
    </style>
</head>
<body>
    
    <!-- HAMBURGER MENU (Mobile) -->
    <div class="hamburger" onclick="toggleSidebar()">
        <span></span>
        <span></span>
        <span></span>
    </div>
    
    <!-- SIDEBAR OVERLAY (Mobile) -->
    <div class="sidebar-overlay" onclick="closeSidebar()"></div>
    
    <!-- LEFT SIDEBAR NAVIGATION -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1>üõ∞Ô∏è FalconOne</h1>
            <p>v1.7.0 SIGINT Platform</p>
        </div>
        
        <nav class="sidebar-nav">
            <div class="nav-item active" onclick="showTab('overview')" data-tab="overview">
                üìä Dashboard
            </div>
            <div class="nav-item" onclick="showTab('devices')" data-tab="devices">
                üîå Device Manager
            </div>
            <div class="nav-item" onclick="showTab('cellular')" data-tab="cellular">
                üì± Cellular Monitor
            </div>
            <div class="nav-item" onclick="showTab('captures')" data-tab="captures">
                üéØ Captures & IMSI
            </div>
            <div class="nav-item" onclick="showTab('exploits')" data-tab="exploits">
                ‚ö° Exploit Engine
            </div>
            <div class="nav-item" onclick="showTab('analytics')" data-tab="analytics">
                ü§ñ AI Analytics
            </div>
            <div class="nav-item" onclick="showTab('terminal')" data-tab="terminal">
                üíª Terminal
            </div>
            <div class="nav-item" onclick="showTab('setup')" data-tab="setup">
                üîß Setup Wizard
            </div>
            <div class="nav-item" onclick="showTab('tools')" data-tab="tools">
                üõ†Ô∏è System Tools
            </div>
            <div class="nav-item" onclick="showTab('system')" data-tab="system">
                üñ•Ô∏è System Health
            </div>
        </nav>
        
        <div class="sidebar-footer">
            <div class="status-item">
                <span>Connection:</span>
                <span id="sidebar-connection-status" style="color: var(--success);">‚óè Online</span>
            </div>
            <div class="status-item">
                <span>Refresh:</span>
                <span><strong>100ms</strong></span>
            </div>
            <div class="status-item">
                <span>User:</span>
                <span><strong id="sidebar-username">admin</strong></span>
            </div>
        </div>
    </aside>
    
    <!-- MAIN CONTENT -->
    <main class="main-content">
        <header class="top-header">
            <div class="header-left">
                <h2 style="font-size: 20px; font-weight: 600;" id="page-title">Dashboard Overview</h2>
            </div>
            <div class="header-right">
                <div class="status-badge">
                    <span style="color: var(--success);">‚óè</span>
                    <span id="connection-status">Connected</span>
                </div>
                <div class="status-badge">
                    <span>Devices: <strong id="header-device-count">0</strong></span>
                </div>
                <div class="status-badge">
                    <span>Alerts: <strong id="header-alert-count">0</strong></span>
                </div>
            </div>
        </header>
        
        <div class="content-area">
    
    <!-- DASHBOARD OVERVIEW TAB -->
    <div id="tab-overview" class="tab-content active">
        <div class="container">
            <!-- KPIs Panel -->
            <div class="panel">
                <h2>üìä Key Performance Indicators</h2>
                <div id="kpis"></div>
                <div class="chart-container">
                    <canvas id="throughput-chart"></canvas>
                </div>
            </div>
            
            <!-- Geolocation Map -->
            <div class="panel">
                <h2>üó∫Ô∏è Geolocation Map</h2>
                <div id="map"></div>
            </div>
            
            <!-- Anomaly Alerts -->
            <div class="panel">
                <h2>‚ö†Ô∏è Anomaly Alerts</h2>
                <div id="anomalies" style="max-height: 300px; overflow-y: auto;"></div>
            </div>
            
            <!-- Quick Status -->
            <div class="panel">
                <h2>‚ö° Quick Status</h2>
                <div id="quick-status"></div>
            </div>
        </div>
    </div>
    
    <!-- DEVICE MANAGER TAB -->
    <div id="tab-devices" class="tab-content">
        <div class="container">
            <!-- Connected Devices Panel -->
            <div class="panel panel-large">
                <h2>üîå Connected SDR Devices</h2>
                <div id="connected-devices-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; margin-top: 15px;">
                    <!-- Device cards will be inserted here dynamically -->
                </div>
                <button onclick="refreshDevices()" style="margin-top: 15px; padding: 10px 20px; background: var(--accent-cyan); color: #000; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                    üîÑ Refresh Devices
                </button>
            </div>
            
            <!-- Install New Device Panel -->
            <div class="panel panel-large">
                <h2>üì• Install Device Driver</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 15px;">
                    <div class="device-install-card" onclick="installDevice('usrp')">
                        <div style="font-size: 48px; text-align: center; margin-bottom: 10px;">üì°</div>
                        <h3 style="margin-bottom: 8px;">USRP</h3>
                        <p style="margin-bottom: 12px;">Ettus Research / NI</p>
                        <button style="width: 100%; padding: 10px; background: var(--success); border: none; border-radius: 6px; cursor: pointer; font-weight: 600; color: #000; transition: var(--transition);" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            Install
                        </button>
                    </div>
                    <div class="device-install-card" onclick="installDevice('hackrf')">
                        <div style="font-size: 48px; text-align: center; margin-bottom: 10px;">üìª</div>
                        <h3 style="margin-bottom: 8px;">HackRF</h3>
                        <p style="margin-bottom: 12px;">Great Scott Gadgets</p>
                        <button style="width: 100%; padding: 10px; background: var(--success); border: none; border-radius: 6px; cursor: pointer; font-weight: 600; color: #000; transition: var(--transition);" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            Install
                        </button>
                    </div>
                    <div class="device-install-card" onclick="installDevice('bladerf')">
                        <div style="font-size: 48px; text-align: center; margin-bottom: 10px;">üì∂</div>
                        <h3 style="margin-bottom: 8px;">bladeRF</h3>
                        <p style="margin-bottom: 12px;">Nuand</p>
                        <button style="width: 100%; padding: 10px; background: var(--success); border: none; border-radius: 6px; cursor: pointer; font-weight: 600; color: #000; transition: var(--transition);" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            Install
                        </button>
                    </div>
                    <div class="device-install-card" onclick="installDevice('limesdr')">
                        <div style="font-size: 48px; text-align: center; margin-bottom: 10px;">üõ∞Ô∏è</div>
                        <h3 style="margin-bottom: 8px;">LimeSDR</h3>
                        <p style="margin-bottom: 12px;">Lime Microsystems</p>
                        <button style="width: 100%; padding: 10px; background: var(--success); border: none; border-radius: 6px; cursor: pointer; font-weight: 600; color: #000; transition: var(--transition);" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            Install
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Device Installation Log -->
            <div class="panel panel-large">
                <h2>üìÑ Installation Log</h2>
                <div id="install-log" style="background: #000; color: #0f0; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 12px; max-height: 300px; overflow-y: auto; white-space: pre-wrap;">
Waiting for installation commands...
                </div>
            </div>
        </div>
    </div>
    
    <!-- TERMINAL TAB -->
    <div id="tab-terminal" class="tab-content">
        <div class="container">
            <!-- Terminal Console Panel -->
            <div class="panel panel-large">
                <h2>üíª System Terminal</h2>
                <div id="terminal-output" style="background: #000; color: #0f0; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 12px; height: 400px; overflow-y: auto; white-space: pre-wrap; margin-bottom: 15px;">
FalconOne Terminal v1.7.0
Type 'help' for available commands
Ready>
                </div>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="terminal-input" placeholder="Enter command..." 
                           style="flex: 1; padding: 10px; background: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-primary); font-family: 'Courier New', monospace;"
                           onkeypress="if(event.key==='Enter') executeTerminalCommand()">
                    <button onclick="executeTerminalCommand()" 
                            style="padding: 10px 20px; background: var(--accent-cyan); color: #000; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                        Execute
                    </button>
                    <button onclick="clearTerminal()" 
                            style="padding: 10px 20px; background: var(--danger); color: #fff; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                        Clear
                    </button>
                </div>
            </div>
            
            <!-- Command History Panel -->
            <div class="panel">
                <h2>üìú Command History</h2>
                <div id="command-history" style="max-height: 300px; overflow-y: auto;">
                    <!-- Command history will be populated here -->
                </div>
            </div>
            
            <!-- Quick Commands Panel -->
            <div class="panel">
                <h2>‚ö° Quick Commands</h2>
                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
                    <button onclick="quickCommand('uhd_find_devices')" class="quick-cmd-btn">Find USRP</button>
                    <button onclick="quickCommand('hackrf_info')" class="quick-cmd-btn">HackRF Info</button>
                    <button onclick="quickCommand('bladeRF-cli -p')" class="quick-cmd-btn">bladeRF Probe</button>
                    <button onclick="quickCommand('LimeUtil --find')" class="quick-cmd-btn">Find LimeSDR</button>
                    <button onclick="quickCommand('lsusb')" class="quick-cmd-btn">List USB</button>
                    <button onclick="quickCommand('dmesg | tail')" class="quick-cmd-btn">System Log</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- CELLULAR TAB -->
    <div id="tab-cellular" class="tab-content">
        <div class="container">
            <div class="panel">
                <h2>üì± GSM / 2G Monitor</h2>
                <div id="cellular-gsm"></div>
            </div>
            <div class="panel">
                <h2>üì± UMTS / 3G Monitor</h2>
                <div id="cellular-umts"></div>
            </div>
            <div class="panel">
                <h2>üì± LTE / 4G Monitor</h2>
                <div id="cellular-lte"></div>
            </div>
            <div class="panel">
                <h2>üì± 5G NR Monitor</h2>
                <div id="cellular-5g"></div>
            </div>
            <div class="panel">
                <h2>üì± 6G Prototype Monitor</h2>
                <div id="cellular-6g"></div>
            </div>
            <div class="panel">
                <h2>üõ∞Ô∏è NTN Satellites</h2>
                <div id="ntn-satellites"></div>
            </div>
        </div>
    </div>
    
    <!-- CAPTURES TAB -->
    <div id="tab-captures" class="tab-content">
        <div class="container">
            <div class="panel panel-large">
                <h2>üéØ SUCI/IMSI Captures</h2>
                <div class="filter-controls">
                    <select id="filter-generation">
                        <option value="">All Generations</option>
                        <option value="5G">5G NR</option>
                        <option value="LTE">LTE</option>
                        <option value="UMTS">UMTS</option>
                        <option value="GSM">GSM</option>
                    </select>
                    <input type="text" id="filter-search" placeholder="Search IMSI/SUCI...">
                    <button class="btn" onclick="refreshCaptures()">üîÑ Refresh</button>
                </div>
                <div id="suci-captures" style="max-height: 400px; overflow-y: auto;"></div>
            </div>
            
            <div class="panel panel-large">
                <h2>üìû Voice/VoNR Interception</h2>
                <div id="voice-calls"></div>
            </div>
            
            <div class="panel panel-large">
                <h2>üì¶ Captured Data Explorer</h2>
                <div id="captured-data"></div>
            </div>
        </div>
    </div>
    
    <!-- EXPLOITS TAB -->
    <div id="tab-exploits" class="tab-content">
        <div class="container">
            <!-- Exploit Controls Header -->
            <div class="panel panel-large">
                <h2>‚ö° Exploit Control Center</h2>
                <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="showExploitHelp()">
                        <i class="fas fa-question-circle"></i> Help & Documentation
                    </button>
                    <button class="btn btn-success" onclick="refreshExploitHistory()">
                        <i class="fas fa-history"></i> View History
                    </button>
                    <button class="btn btn-warning" onclick="exportExploitResults()">
                        <i class="fas fa-download"></i> Export Results
                    </button>
                    <button class="btn" style="background: var(--accent-cyan); color: #000;" onclick="loadUnifiedDatabase()">
                        üóÇÔ∏è Load Vulnerability Database
                    </button>
                </div>
                <div id="active-exploits-summary"></div>
            </div>
            
            <!-- UNIFIED VULNERABILITY DATABASE -->
            <div class="panel panel-large">
                <h2>üóÇÔ∏è Unified Vulnerability Database</h2>
                <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 15px;">
                    Browse all available exploits (RANSacked CVEs + Native FalconOne exploits) with filtering and chaining capabilities
                </p>
                
                <!-- Database Statistics -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div style="padding: 15px; background: var(--bg-dark); border-radius: 10px; border-left: 4px solid var(--primary-blue); text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: var(--primary-blue);" id="unified-total-count">25</div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">Total Exploits</div>
                    </div>
                    <div style="padding: 15px; background: var(--bg-dark); border-radius: 10px; border-left: 4px solid var(--danger); text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: var(--danger);" id="unified-critical-count">-</div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">Critical (CVSS ‚â•9)</div>
                    </div>
                    <div style="padding: 15px; background: var(--bg-dark); border-radius: 10px; border-left: 4px solid var(--success); text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: var(--success);" id="unified-success-rate">81%</div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">Avg Success Rate</div>
                    </div>
                    <div style="padding: 15px; background: var(--bg-dark); border-radius: 10px; border-left: 4px solid var(--accent-cyan); text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: var(--accent-cyan);" id="unified-avg-cvss">7.5</div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">Avg CVSS Score</div>
                    </div>
                    <div style="padding: 15px; background: var(--bg-dark); border-radius: 10px; border-left: 4px solid var(--warning); text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: var(--warning);" id="unified-chains-count">7</div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">Available Chains</div>
                    </div>
                </div>
                
                <!-- Filters -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 13px; color: var(--text-secondary);">Implementation</label>
                        <select id="unified-impl-filter" style="width: 100%; padding: 10px; background: var(--bg-dark); border: 1px solid var(--border-color); border-radius: 5px; color: var(--text-primary); font-size: 14px;" onchange="filterUnifiedExploits()">
                            <option value="">All Implementations</option>
                            <option value="Open5GS">Open5GS (19)</option>
                            <option value="OpenAirInterface">OpenAirInterface</option>
                            <option value="Magma">Magma</option>
                            <option value="srsRAN">srsRAN</option>
                            <option value="free5GC">free5GC</option>
                            <option value="Amarisoft">Amarisoft</option>
                            <option value="any">FalconOne Native (5)</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 13px; color: var(--text-secondary);">Category</label>
                        <select id="unified-category-filter" style="width: 100%; padding: 10px; background: var(--bg-dark); border: 1px solid var(--border-color); border-radius: 5px; color: var(--text-primary); font-size: 14px;" onchange="filterUnifiedExploits()">
                            <option value="">All Categories</option>
                            <option value="denial_of_service">Denial of Service</option>
                            <option value="authentication">Authentication Bypass</option>
                            <option value="interception">Interception/IMSI Catching</option>
                            <option value="memory_corruption">Memory Corruption</option>
                            <option value="protocol_exploit">Protocol Exploitation</option>
                            <option value="injection">Message Injection</option>
                            <option value="core_network">Core Network</option>
                            <option value="air_interface">Air Interface</option>
                            <option value="replay_attack">Replay Attack</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 13px; color: var(--text-secondary);">Min CVSS Score</label>
                        <input type="number" id="unified-cvss-filter" min="0" max="10" step="0.1" placeholder="0.0 - 10.0" style="width: 100%; padding: 10px; background: var(--bg-dark); border: 1px solid var(--border-color); border-radius: 5px; color: var(--text-primary); font-size: 14px;" onchange="filterUnifiedExploits()">
                    </div>
                    <div style="display: flex; align-items: flex-end;">
                        <button onclick="filterUnifiedExploits()" class="btn" style="background: var(--primary-blue); width: 100%; padding: 10px;">
                            üîç Apply Filters
                        </button>
                    </div>
                </div>
                
                <!-- Exploits Table -->
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; background: var(--bg-dark); border-radius: 8px; overflow: hidden;">
                        <thead>
                            <tr style="background: var(--bg-darker); border-bottom: 2px solid var(--border-color);">
                                <th style="padding: 12px; text-align: left; font-size: 12px; color: var(--text-secondary); font-weight: 600;">Exploit ID</th>
                                <th style="padding: 12px; text-align: left; font-size: 12px; color: var(--text-secondary); font-weight: 600;">Name</th>
                                <th style="padding: 12px; text-align: left; font-size: 12px; color: var(--text-secondary); font-weight: 600;">Category</th>
                                <th style="padding: 12px; text-align: center; font-size: 12px; color: var(--text-secondary); font-weight: 600;">CVSS</th>
                                <th style="padding: 12px; text-align: center; font-size: 12px; color: var(--text-secondary); font-weight: 600;">Success</th>
                                <th style="padding: 12px; text-align: left; font-size: 12px; color: var(--text-secondary); font-weight: 600;">Implementation</th>
                                <th style="padding: 12px; text-align: center; font-size: 12px; color: var(--text-secondary); font-weight: 600;">Chains</th>
                                <th style="padding: 12px; text-align: center; font-size: 12px; color: var(--text-secondary); font-weight: 600;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="unified-exploits-table-body">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 30px; color: var(--text-secondary);">
                                    <div style="margin-bottom: 10px;">üìä</div>
                                    <div>Click "Load Vulnerability Database" to view available exploits</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- AUTO-EXPLOIT ENGINE -->
            <div class="panel panel-large">
                <h2>ü§ñ Auto-Exploit Engine</h2>
                <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 15px;">
                    Automated exploitation workflow: Fingerprint target ‚Üí Query database ‚Üí Select optimal chain ‚Üí Execute exploits
                </p>
                
                <!-- Target Configuration -->
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 13px; color: var(--text-secondary);">Target IP Address <span style="color: var(--danger);">*</span></label>
                        <input type="text" id="auto-exploit-target-ip" placeholder="e.g., 192.168.1.100" style="width: 100%; padding: 10px; background: var(--bg-dark); border: 1px solid var(--border-color); border-radius: 5px; color: var(--text-primary); font-size: 14px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 13px; color: var(--text-secondary);">Implementation</label>
                        <select id="auto-exploit-impl" style="width: 100%; padding: 10px; background: var(--bg-dark); border: 1px solid var(--border-color); border-radius: 5px; color: var(--text-primary); font-size: 14px;">
                            <option value="">Auto-detect</option>
                            <option value="Open5GS">Open5GS</option>
                            <option value="OpenAirInterface">OpenAirInterface</option>
                            <option value="Magma">Magma</option>
                            <option value="srsRAN">srsRAN</option>
                            <option value="free5GC">free5GC</option>
                            <option value="Amarisoft">Amarisoft</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 13px; color: var(--text-secondary);">Version</label>
                        <input type="text" id="auto-exploit-version" placeholder="e.g., 2.7.0" style="width: 100%; padding: 10px; background: var(--bg-dark); border: 1px solid var(--border-color); border-radius: 5px; color: var(--text-primary); font-size: 14px;">
                    </div>
                </div>
                
                <!-- Options -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div style="padding: 12px; background: var(--bg-dark); border-radius: 5px; border: 1px solid var(--border-color);">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="auto-exploit-chaining" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">
                            <span style="font-size: 14px; color: var(--text-primary);">Enable Exploit Chaining</span>
                        </label>
                    </div>
                    <div style="padding: 12px; background: var(--bg-dark); border-radius: 5px; border: 1px solid var(--border-color);">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="auto-exploit-post-actions" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">
                            <span style="font-size: 14px; color: var(--text-primary);">Post-Exploit Actions (IMSI)</span>
                        </label>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 13px; color: var(--text-secondary);">Max Chain Length</label>
                        <input type="number" id="auto-exploit-max-depth" min="1" max="5" value="3" style="width: 100%; padding: 10px; background: var(--bg-dark); border: 1px solid var(--border-color); border-radius: 5px; color: var(--text-primary); font-size: 14px;">
                    </div>
                </div>
                
                <!-- Execute Button -->
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button onclick="runAutoExploit()" id="auto-exploit-btn" class="btn" style="background: var(--success); padding: 12px 30px; font-size: 15px;">
                        <span id="auto-exploit-icon">üöÄ</span> Launch Auto-Exploit
                    </button>
                    <button onclick="stopAutoExploit()" class="btn" style="background: var(--danger); padding: 12px 30px; font-size: 15px;">
                        ‚èπÔ∏è Stop
                    </button>
                    <button onclick="showExploitChainVisualization()" class="btn" style="background: var(--accent-cyan); color: #000; padding: 12px 30px; font-size: 15px;">
                        üìä View Chain Visualization
                    </button>
                </div>
                
                <!-- Auto-Exploit Results -->
                <div id="auto-exploit-results" style="margin-top: 20px; display: none;">
                    <div style="padding: 15px; background: var(--bg-dark); border-radius: 8px; margin-bottom: 15px;">
                        <h3 style="font-size: 16px; margin: 0 0 15px 0; color: var(--text-primary);">Execution Timeline</h3>
                        <div id="auto-exploit-timeline" style="display: flex; flex-direction: column; gap: 10px;">
                            <!-- Timeline populated by JS -->
                        </div>
                    </div>
                    
                    <div style="padding: 15px; background: var(--bg-dark); border-radius: 8px;">
                        <h3 style="font-size: 16px; margin: 0 0 10px 0; color: var(--text-primary);">Results Summary</h3>
                        <div id="auto-exploit-summary" style="display: grid; gap: 10px; font-size: 13px;">
                            <!-- Summary populated by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Crypto Attacks -->
            <div class="panel">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; padding-bottom: 10px; border-bottom: 2px solid var(--border-color);">
                    <h2 style="margin: 0; border: none; padding: 0;">üîê Cryptographic Attacks</h2>
                    <button class="btn btn-info btn-sm" onclick="showExploitHelp('crypto')">
                        <i class="fas fa-info-circle"></i> Help
                    </button>
                </div>
                <div class="exploit-controls">
                    <div class="form-group">
                        <label>Attack Type:</label>
                        <select id="crypto-attack-type" class="form-control" onchange="updateCryptoForm(this.value)">
                            <option value="">-- Select Attack --</option>
                            <option value="a5_1_crack">A5/1 Stream Cipher Crack</option>
                            <option value="kasumi_attack">KASUMI/SNOW 3G Attack</option>
                            <option value="suci_deconcealment">SUCI Deconcealment</option>
                        </select>
                    </div>
                    <div id="crypto-form-container"></div>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="runExploit('crypto')">
                            <i class="fas fa-play"></i> Execute
                        </button>
                        <button class="btn btn-danger" onclick="stopAllExploits('crypto')">
                            <i class="fas fa-stop"></i> Stop All
                        </button>
                    </div>
                </div>
                <div id="exploit-crypto-results"></div>
            </div>

            <!-- NTN Attacks -->
            <div class="panel">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; padding-bottom: 10px; border-bottom: 2px solid var(--border-color);">
                    <h2 style="margin: 0; border: none; padding: 0;">üõ∞Ô∏è Non-Terrestrial Network Attacks</h2>
                    <button class="btn btn-info btn-sm" onclick="showExploitHelp('ntn')">
                        <i class="fas fa-info-circle"></i> Help
                    </button>
                </div>
                <div class="exploit-controls">
                    <div class="form-group">
                        <label>Attack Type:</label>
                        <select id="ntn-attack-type" class="form-control" onchange="updateNtnForm(this.value)">
                            <option value="">-- Select Attack --</option>
                            <option value="satellite_hijack">Satellite Communication Hijacking</option>
                            <option value="iot_ntn_exploit">IoT-NTN Vulnerability Exploitation</option>
                        </select>
                    </div>
                    <div id="ntn-form-container"></div>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="runExploit('ntn')">
                            <i class="fas fa-play"></i> Execute
                        </button>
                        <button class="btn btn-danger" onclick="stopAllExploits('ntn')">
                            <i class="fas fa-stop"></i> Stop All
                        </button>
                    </div>
                </div>
                <div id="exploit-ntn-results"></div>
            </div>

            <!-- V2X Attacks -->
            <div class="panel">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; padding-bottom: 10px; border-bottom: 2px solid var(--border-color);">
                    <h2 style="margin: 0; border: none; padding: 0;">üöó Vehicle-to-Everything (V2X) Attacks</h2>
                    <button class="btn btn-info btn-sm" onclick="showExploitHelp('v2x')">
                        <i class="fas fa-info-circle"></i> Help
                    </button>
                </div>
                <div class="exploit-controls">
                    <div class="form-group">
                        <label>Attack Type:</label>
                        <select id="v2x-attack-type" class="form-control" onchange="updateV2xForm(this.value)">
                            <option value="">-- Select Attack --</option>
                            <option value="c_v2x_jam">C-V2X Jamming Attack</option>
                            <option value="message_injection">V2X Message Injection</option>
                        </select>
                    </div>
                    <div id="v2x-form-container"></div>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="runExploit('v2x')">
                            <i class="fas fa-play"></i> Execute
                        </button>
                        <button class="btn btn-danger" onclick="stopAllExploits('v2x')">
                            <i class="fas fa-stop"></i> Stop All
                        </button>
                    </div>
                </div>
                <div id="exploit-v2x-results"></div>
            </div>

            <!-- Message Injection -->
            <div class="panel">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; padding-bottom: 10px; border-bottom: 2px solid var(--border-color);">
                    <h2 style="margin: 0; border: none; padding: 0;">üíâ Message Injection Attacks</h2>
                    <button class="btn btn-info btn-sm" onclick="showExploitHelp('message_injection')">
                        <i class="fas fa-info-circle"></i> Help
                    </button>
                </div>
                <div class="exploit-controls">
                    <div class="form-group">
                        <label>Attack Type:</label>
                        <select id="msg-attack-type" class="form-control" onchange="updateMsgForm(this.value)">
                            <option value="">-- Select Attack --</option>
                            <option value="silent_sms">Silent SMS (Type 0)</option>
                            <option value="fake_emergency">Fake Emergency Alert</option>
                        </select>
                    </div>
                    <div id="msg-form-container"></div>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="runExploit('message_injection')">
                            <i class="fas fa-play"></i> Execute
                        </button>
                        <button class="btn btn-danger" onclick="stopAllExploits('message_injection')">
                            <i class="fas fa-stop"></i> Stop All
                        </button>
                    </div>
                </div>
                <div id="exploit-injection-results"></div>
            </div>

            <!-- Downgrade Attacks -->
            <div class="panel">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; padding-bottom: 10px; border-bottom: 2px solid var(--border-color);">
                    <h2 style="margin: 0; border: none; padding: 0;">üîΩ Downgrade Attacks</h2>
                    <button class="btn btn-info btn-sm" onclick="showExploitHelp('downgrade')">
                        <i class="fas fa-info-circle"></i> Help
                    </button>
                </div>
                <div class="exploit-controls">
                    <div class="form-group">
                        <label>Attack Type:</label>
                        <select id="downgrade-attack-type" class="form-control" onchange="updateDowngradeForm(this.value)">
                            <option value="">-- Select Attack --</option>
                            <option value="lte_to_3g">LTE to 3G Downgrade</option>
                            <option value="fiveg_security_downgrade">5G Security Context Downgrade</option>
                        </select>
                    </div>
                    <div id="downgrade-form-container"></div>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="runExploit('downgrade')">
                            <i class="fas fa-play"></i> Execute
                        </button>
                        <button class="btn btn-danger" onclick="stopAllExploits('downgrade')">
                            <i class="fas fa-stop"></i> Stop All
                        </button>
                    </div>
                </div>
                <div id="downgrade-attacks-results"></div>
            </div>

            <!-- Paging Spoofing -->
            <div class="panel">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; padding-bottom: 10px; border-bottom: 2px solid var(--border-color);">
                    <h2 style="margin: 0; border: none; padding: 0;">üì° Paging Spoofing</h2>
                    <button class="btn btn-info btn-sm" onclick="showExploitHelp('paging')">
                        <i class="fas fa-info-circle"></i> Help
                    </button>
                </div>
                <div class="exploit-controls">
                    <div class="form-group">
                        <label>Attack Type:</label>
                        <select id="paging-attack-type" class="form-control" onchange="updatePagingForm(this.value)">
                            <option value="">-- Select Attack --</option>
                            <option value="paging_scan">Passive Paging Monitoring</option>
                            <option value="paging_storm">Paging Storm Attack (DoS)</option>
                        </select>
                    </div>
                    <div id="paging-form-container"></div>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="runExploit('paging')">
                            <i class="fas fa-play"></i> Execute
                        </button>
                        <button class="btn btn-danger" onclick="stopAllExploits('paging')">
                            <i class="fas fa-stop"></i> Stop All
                        </button>
                    </div>
                </div>
                <div id="paging-spoof-results"></div>
            </div>

            <!-- AIoT Exploits -->
            <div class="panel">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; padding-bottom: 10px; border-bottom: 2px solid var(--border-color);">
                    <h2 style="margin: 0; border: none; padding: 0;">ü§ñ AIoT (AI + IoT) Exploits</h2>
                    <button class="btn btn-info btn-sm" onclick="showExploitHelp('aiot')">
                        <i class="fas fa-info-circle"></i> Help
                    </button>
                </div>
                <div class="exploit-controls">
                    <div class="form-group">
                        <label>Attack Type:</label>
                        <select id="aiot-attack-type" class="form-control" onchange="updateAiotForm(this.value)">
                            <option value="">-- Select Attack --</option>
                            <option value="aiot_poisoning">AIoT Model Poisoning</option>
                            <option value="federated_manipulation">Federated Learning Manipulation</option>
                        </select>
                    </div>
                    <div id="aiot-form-container"></div>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="runExploit('aiot')">
                            <i class="fas fa-play"></i> Execute
                        </button>
                        <button class="btn btn-danger" onclick="stopAllExploits('aiot')">
                            <i class="fas fa-stop"></i> Stop All
                        </button>
                    </div>
                </div>
                <div id="aiot-exploits-results"></div>
            </div>

            <!-- Semantic 6G -->
            <div class="panel">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; padding-bottom: 10px; border-bottom: 2px solid var(--border-color);">
                    <h2 style="margin: 0; border: none; padding: 0;">üåê Semantic 6G Attacks</h2>
                    <button class="btn btn-info btn-sm" onclick="showExploitHelp('semantic_6g')">
                        <i class="fas fa-info-circle"></i> Help
                    </button>
                </div>
                <div class="exploit-controls">
                    <div class="form-group">
                        <label>Attack Type:</label>
                        <select id="semantic-attack-type" class="form-control" onchange="updateSemanticForm(this.value)">
                            <option value="">-- Select Attack --</option>
                            <option value="semantic_injection">Semantic Information Injection</option>
                            <option value="knowledge_graph_poisoning">Knowledge Graph Poisoning</option>
                        </select>
                    </div>
                    <div id="semantic-form-container"></div>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="runExploit('semantic_6g')">
                            <i class="fas fa-play"></i> Execute
                        </button>
                        <button class="btn btn-danger" onclick="stopAllExploits('semantic_6g')">
                            <i class="fas fa-stop"></i> Stop All
                        </button>
                    </div>
                </div>
                <div id="semantic-6g-results"></div>
            </div>

            <!-- Security Audit -->
            <div class="panel panel-large">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; padding-bottom: 10px; border-bottom: 2px solid var(--border-color);">
                    <h2 style="margin: 0; border: none; padding: 0;">üõ°Ô∏è Security Audit</h2>
                    <button class="btn btn-info btn-sm" onclick="showExploitHelp('security_audit')">
                        <i class="fas fa-info-circle"></i> Help
                    </button>
                </div>
                <div class="exploit-controls">
                    <div class="form-group">
                        <label>Audit Type:</label>
                        <select id="audit-type" class="form-control">
                            <option value="full_audit">Complete Security Audit</option>
                            <option value="vulnerability_scan">Vulnerability Scanner</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Target ID:</label>
                        <input type="text" id="audit-target" class="form-control" placeholder="Enter target ID">
                    </div>
                    <div class="form-group">
                        <label>Audit Depth:</label>
                        <select id="audit-depth" class="form-control">
                            <option value="quick">Quick Scan</option>
                            <option value="standard" selected>Standard Audit</option>
                            <option value="deep">Deep Analysis</option>
                        </select>
                    </div>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="runSecurityAudit()">
                            <i class="fas fa-play"></i> Start Audit
                        </button>
                    </div>
                </div>
                <div id="security-audit-results"></div>
            </div>
        </div>
    </div>
    
    <!-- ANALYTICS TAB -->
    <div id="tab-analytics" class="tab-content">
        <div class="container">
            <div class="panel panel-large">
                <h2>üì° Live Spectrum Analyzer</h2>
                <canvas id="spectrum-canvas" class="spectrum-canvas"></canvas>
                <div id="spectrum-info"></div>
            </div>
            
            <div class="panel">
                <h2>üîó Cyber-RF Fusion</h2>
                <div id="analytics-fusion"></div>
            </div>
            
            <div class="panel">
                <h2>ü§ñ Signal Classification (AI/ML)</h2>
                <div id="analytics-classifier"></div>
            </div>
            
            <div class="panel">
                <h2>ü§ù Federated Agents (MARL)</h2>
                <div id="agents"></div>
            </div>
            
            <div class="panel">
                <h2>üìä RIC Optimization (O-RAN)</h2>
                <div id="analytics-ric"></div>
            </div>
            
            <div class="panel">
                <h2>üå± Carbon Emissions</h2>
                <div id="emissions"></div>
                <div class="chart-container">
                    <canvas id="emissions-chart"></canvas>
                </div>
            </div>
            
            <div class="panel">
                <h2>üéØ Precision Geolocation</h2>
                <div id="precision-geo"></div>
            </div>
            
            <div class="panel">
                <h2>üìè Data Validator (SNR/Quality)</h2>
                <div id="data-validator"></div>
            </div>
        </div>
    </div>
    
    <!-- v1.7.0 PHASE 1 FEATURES TAB -->
    <div id="tab-v170" class="tab-content">
        <div class="container">
            <div class="panel">
                <h2>üåç Environmental Adaptation</h2>
                <div id="environmental-adaptation">
                    <p><span class="status-indicator status-inactive"></span>Loading...</p>
                </div>
            </div>
            
            <div class="panel">
                <h2>üìà Profiling Dashboard</h2>
                <div id="profiling-metrics">
                    <p><span class="status-indicator status-inactive"></span>Loading...</p>
                </div>
            </div>
            
            <div class="panel">
                <h2>üß™ E2E Validation</h2>
                <div id="e2e-validation">
                    <p><span class="status-indicator status-inactive"></span>Loading...</p>
                </div>
            </div>
            
            <div class="panel">
                <h2>ü§ñ ML Model Zoo</h2>
                <div id="model-zoo">
                    <p><span class="status-indicator status-inactive"></span>Loading...</p>
                </div>
            </div>
            
            <div class="panel">
                <h2>üîÑ Error Recovery Framework</h2>
                <div id="error-recovery-status">
                    <p><span class="status-indicator status-inactive"></span>Loading...</p>
                </div>
            </div>
            
            <div class="panel">
                <h2>‚úÖ Data Validation</h2>
                <div id="data-validation">
                    <p><span class="status-indicator status-inactive"></span>Loading...</p>
                </div>
            </div>
            
            <div class="panel">
                <h2>‚ö° Performance Optimizations</h2>
                <div id="performance-stats">
                    <p><span class="status-indicator status-inactive"></span>Loading...</p>
                </div>
            </div>
            
            <div class="panel">
                <h2>üîê Security Auditor</h2>
                <div id="security-auditor-panel">
                    <p><span class="status-indicator status-inactive"></span>Loading...</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- SYSTEM TAB -->
    <div id="tab-system" class="tab-content">
        <div class="container">
            <div class="panel panel-large">
                <h2>üñ•Ô∏è System Health</h2>
                <div id="system-health"></div>
            </div>
            
            <div class="panel">
                <h2>üì° SDR Devices</h2>
                <div id="sdr-devices"></div>
            </div>
            
            <div class="panel panel-large">
                <h2>üéØ Target Management</h2>
                <div id="targets"></div>
            </div>
            
            <div class="panel panel-large">
                <h2>üîß Error Recovery Events</h2>
                <div id="error-recovery" style="max-height: 300px; overflow-y: auto;"></div>
            </div>
            
            <div class="panel">
                <h2>‚öôÔ∏è Config Management</h2>
                <div id="config-management"></div>
            </div>
            
            <div class="panel">
                <h2>üìã Regulatory Scanner</h2>
                <div id="regulatory-scanner"></div>
            </div>
        </div>
    </div>
    
    <!-- RANSacked vulnerabilities are now integrated into Exploit Engine tab -->
    <!-- SETUP WIZARD TAB -->
    <div id="tab-setup" class="tab-content">
        <div class="container">
            <!-- Connected Devices Overview -->
            <div class="panel panel-large">
                <h2>üîå Connected SDR Devices</h2>
                <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 15px;">
                    Real-time status of SDR hardware detected on your system
                </p>
                <div id="connected-devices-overview" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-top: 15px;">
                    <!-- Will be populated by JavaScript -->
                    <div style="text-align: center; padding: 40px; grid-column: 1 / -1; color: var(--text-secondary);">
                        <div class="loading-spinner" style="margin: 0 auto 15px;"></div>
                        <p>Scanning for connected devices...</p>
                    </div>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="refreshDeviceStatus()" class="btn" style="background: var(--primary-blue);">
                        üîÑ Refresh Status
                    </button>
                    <button onclick="checkDependencies()" class="btn" style="background: var(--accent-cyan); color: #000;">
                        üîç Check All Dependencies
                    </button>
                </div>
            </div>
            
            <!-- Device Management Actions -->
            <div class="panel panel-large">
                <h2>‚öôÔ∏è Device Management</h2>
                <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 20px;">
                    Choose an action to manage your SDR devices and system configuration
                </p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 15px;">
                    <!-- Install Drivers -->
                    <div class="action-card" style="padding: 20px; background: var(--bg-dark); border-radius: 10px; border: 2px solid var(--success); cursor: pointer; transition: all 0.3s; text-align: center;" onclick="showInstallSection()">
                        <div style="font-size: 40px; margin-bottom: 10px;">üì•</div>
                        <h3 style="margin: 0 0 8px 0; color: var(--success); font-size: 16px;">Install Drivers</h3>
                        <p style="margin: 0; font-size: 13px; color: var(--text-secondary);">Install SDR drivers and dependencies</p>
                    </div>
                    
                    <!-- Verify Connection -->
                    <div class="action-card" style="padding: 20px; background: var(--bg-dark); border-radius: 10px; border: 2px solid var(--primary-blue); cursor: pointer; transition: all 0.3s; text-align: center;" onclick="showVerifySection()">
                        <div style="font-size: 40px; margin-bottom: 10px;">‚úÖ</div>
                        <h3 style="margin: 0 0 8px 0; color: var(--primary-blue); font-size: 16px;">Verify Connection</h3>
                        <p style="margin: 0; font-size: 13px; color: var(--text-secondary);">Test device connectivity and functionality</p>
                    </div>
                    
                    <!-- Fix Issues -->
                    <div class="action-card" style="padding: 20px; background: var(--bg-dark); border-radius: 10px; border: 2px solid var(--warning); cursor: pointer; transition: all 0.3s; text-align: center;" onclick="showFixSection()">
                        <div style="font-size: 40px; margin-bottom: 10px;">üîß</div>
                        <h3 style="margin: 0 0 8px 0; color: var(--warning); font-size: 16px;">Fix Issues</h3>
                        <p style="margin: 0; font-size: 13px; color: var(--text-secondary);">Troubleshoot and repair device problems</p>
                    </div>
                    
                    <!-- Uninstall Drivers -->
                    <div class="action-card" style="padding: 20px; background: var(--bg-dark); border-radius: 10px; border: 2px solid var(--danger); cursor: pointer; transition: all 0.3s; text-align: center;" onclick="showUninstallSection()">
                        <div style="font-size: 40px; margin-bottom: 10px;">üóëÔ∏è</div>
                        <h3 style="margin: 0 0 8px 0; color: var(--danger); font-size: 16px;">Uninstall Drivers</h3>
                        <p style="margin: 0; font-size: 13px; color: var(--text-secondary);">Remove SDR drivers from system</p>
                    </div>
                    
                    <!-- Reset Configuration -->
                    <div class="action-card" style="padding: 20px; background: var(--bg-dark); border-radius: 10px; border: 2px solid var(--accent-purple); cursor: pointer; transition: all 0.3s; text-align: center;" onclick="showResetSection()">
                        <div style="font-size: 40px; margin-bottom: 10px;">üîÑ</div>
                        <h3 style="margin: 0 0 8px 0; color: var(--accent-purple); font-size: 16px;">Reset Configuration</h3>
                        <p style="margin: 0; font-size: 13px; color: var(--text-secondary);">Reset device settings to defaults</p>
                    </div>
                </div>
            </div>
            
            <!-- System Dependencies Status -->
            <div class="panel panel-large" id="dependencies-panel" style="display: none;">
                <h2>‚úÖ System Dependencies</h2>
                <div id="dependencies-status"></div>
            </div>
            
            <!-- Dynamic Action Sections -->
            <div id="action-sections" style="animation: fadeIn 0.4s ease-in;">
                <!-- Content will be dynamically loaded here -->
            </div>
        </div>
    </div>
    
    <!-- SYSTEM TOOLS TAB -->
    <div id="tab-tools" class="tab-content">
        <div class="container">
            <div class="panel panel-large">
                <h2>üõ†Ô∏è System Tools Management</h2>
                <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 20px;">
                    Manage external system tools required for cellular monitoring (gr-gsm, LTESniffer, srsRAN, GNU Radio, etc.)
                </p>
                
                <!-- Summary Stats -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div style="padding: 20px; background: var(--bg-dark); border-radius: 10px; border-left: 4px solid var(--success);">
                        <div style="font-size: 28px; font-weight: bold; color: var(--success);" id="tools-installed-count">0</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 5px;">Installed Tools</div>
                    </div>
                    <div style="padding: 20px; background: var(--bg-dark); border-radius: 10px; border-left: 4px solid var(--danger);">
                        <div style="font-size: 28px; font-weight: bold; color: var(--danger);" id="tools-missing-count">0</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 5px;">Missing Tools</div>
                    </div>
                    <div style="padding: 20px; background: var(--bg-dark); border-radius: 10px; border-left: 4px solid var(--primary-blue);">
                        <div style="font-size: 28px; font-weight: bold; color: var(--primary-blue);" id="tools-completion-percent">0%</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 5px;">Completion</div>
                    </div>
                </div>
                
                <!-- Refresh Button -->
                <div style="margin-bottom: 20px;">
                    <button onclick="loadSystemToolsStatus()" class="btn" style="background: var(--primary-blue);">
                        üîÑ Refresh Status
                    </button>
                </div>
                
                <!-- Tools Grid -->
                <div id="system-tools-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 15px;">
                    <!-- Will be populated by JavaScript -->
                    <div style="text-align: center; padding: 40px; grid-column: 1 / -1; color: var(--text-secondary);">
                        <div class="loading-spinner" style="margin: 0 auto 15px;"></div>
                        <p>Loading system tools status...</p>
                    </div>
                </div>
            </div>
            
            <!-- Tool Details Modal -->
            <div id="tool-details-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 9999; padding: 20px; overflow-y: auto;">
                <div style="max-width: 700px; margin: 40px auto; background: var(--bg-darker); border-radius: 15px; padding: 30px; position: relative;">
                    <button onclick="closeToolDetails()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-secondary);">‚úï</button>
                    <div id="tool-details-content"></div>
                </div>
            </div>
        </div>
    </div>
    
        </div><!-- Close content-area -->
    </main><!-- Close main-content -->
    
    <script>
        // WebSocket connection
        const socket = io();
        
        // ==================== INITIALIZATION ====================
        
        // Ensure first tab is visible on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Show overview tab by default
            showTab('overview');
        });
        
        // ==================== RESPONSIVE SIDEBAR FUNCTIONS ====================
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            const hamburger = document.querySelector('.hamburger');
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
            hamburger.classList.toggle('active');
        }
        
        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            const hamburger = document.querySelector('.hamburger');
            
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
            hamburger.classList.remove('active');
        }
        
        // Close sidebar when clicking a nav item on mobile
        function handleNavClick(callback) {
            // Execute the callback
            if (typeof callback === 'function') {
                callback();
            }
            
            // Close sidebar on mobile screens
            if (window.innerWidth <= 768) {
                closeSidebar();
            }
        }
        
        // Handle window resize
        window.addEventListener('resize', function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            const hamburger = document.querySelector('.hamburger');
            
            // Auto-close sidebar on desktop
            if (window.innerWidth > 768) {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
                hamburger.classList.remove('active');
            }
        });
        
        // Tab switching with sidebar highlighting
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            
            // Show selected tab
            const selectedTab = document.getElementById('tab-' + tabName);
            if (selectedTab) {
                selectedTab.style.display = 'block';
            }
            
            // Highlight active nav item
            const navItem = document.querySelector(`[data-tab="${tabName}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }
            
            // Update page title
            const titles = {
                'overview': 'Dashboard Overview',
                'devices': 'Device Manager',
                'cellular': 'Cellular Monitor',
                'captures': 'Captures & IMSI',
                'exploits': 'Exploit Engine',
                'analytics': 'AI Analytics',
                'terminal': 'System Terminal',
                'setup': 'Setup Wizard',
                'tools': 'System Tools',
                'system': 'System Health'
            };
            document.getElementById('page-title').textContent = titles[tabName] || 'Dashboard';
            
            // Load tab-specific data
            if (tabName === 'exploits') {
                // Auto-load unified database if needed
                // Uncomment to auto-load: loadUnifiedDatabase();
            }
            
            // Close sidebar on mobile after tab switch
            if (window.innerWidth <= 768) {
                closeSidebar();
            }
        }
        
        // ==================== DEVICE MANAGEMENT FUNCTIONS ====================
        
        async function refreshDevices() {
            try {
                const response = await fetch('/api/devices/connected');
                const data = await response.json();
                
                if (data.success) {
                    renderDeviceCards(data.devices);
                    document.getElementById('header-device-count').textContent = data.total || 0;
                } else {
                    console.error('Failed to fetch devices:', data.error);
                }
            } catch (error) {
                console.error('Error fetching devices:', error);
            }
        }
        
        function renderDeviceCards(devices) {
            const container = document.getElementById('connected-devices-grid');
            
            if (!devices || devices.length === 0) {
                container.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--text-secondary);">No devices connected. Connect a device or install drivers.</div>';
                return;
            }
            
            container.innerHTML = devices.map(device => `
                <div class="device-card">
                    <div class="device-card-header">
                        <div class="device-icon">${device.icon}</div>
                        <div class="device-info">
                            <h3>${device.name}</h3>
                            <p>${device.driver || 'Unknown Driver'}</p>
                        </div>
                    </div>
                    <div class="device-status ${device.connected ? 'online' : 'offline'}">
                        <span>${device.connected ? '‚óè' : '‚óã'}</span>
                        <span>${device.connected ? 'Online' : 'Offline'}</span>
                    </div>
                    <div class="device-capabilities">
                        ${device.capabilities ? device.capabilities.map(cap => 
                            `<span class="capability-badge">${cap}</span>`
                        ).join('') : ''}
                    </div>
                    <div style="font-size: 11px; color: var(--text-secondary); margin: 8px 0;">
                        ${device.info || 'No additional information'}
                    </div>
                    <div class="device-actions">
                        <button class="device-btn test" onclick="testDevice('${device.id}')">
                            üîç Test
                        </button>
                        <button class="device-btn configure" onclick="configureDevice('${device.id}')">
                            ‚öôÔ∏è Configure
                        </button>
                        <button class="device-btn uninstall" onclick="uninstallDevice('${device.id}')">
                            üóëÔ∏è Uninstall
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        async function installDevice(deviceType) {
            try {
                const response = await fetch('/api/devices/install', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ device_type: deviceType })
                });
                const data = await response.json();
                
                if (data.success) {
                    const logDiv = document.getElementById('install-log');
                    logDiv.textContent = `Installing ${deviceType.toUpperCase()} driver...\n\n`;
                    logDiv.textContent += `Commands to run:\n${data.commands.join('\n')}\n\n`;
                    logDiv.textContent += `Log:\n${data.log.join('\n')}\n`;
                    logDiv.scrollTop = logDiv.scrollHeight;
                    
                    alert(`Installation commands prepared for ${deviceType.toUpperCase()}.\nPlease run the commands shown in the Installation Log.`);
                } else {
                    alert('Installation failed: ' + data.error);
                }
            } catch (error) {
                console.error('Error installing device:', error);
                alert('Error: ' + error.message);
            }
        }
        
        async function uninstallDevice(deviceType) {
            if (!confirm(`Are you sure you want to uninstall ${deviceType.toUpperCase()} driver? This will remove all associated software.`)) {
                return;
            }
            
            try {
                const response = await fetch('/api/devices/uninstall', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ device_type: deviceType })
                });
                const data = await response.json();
                
                if (data.success) {
                    const logDiv = document.getElementById('install-log');
                    logDiv.textContent = `Uninstalling ${deviceType.toUpperCase()} driver...\n\n`;
                    logDiv.textContent += `Commands to run:\n${data.commands.join('\n')}\n\n`;
                    logDiv.textContent += `Log:\n${data.log.join('\n')}\n`;
                    logDiv.scrollTop = logDiv.scrollHeight;
                    
                    // Refresh device list after uninstall
                    setTimeout(refreshDevices, 2000);
                } else {
                    alert('Uninstall failed: ' + data.error);
                }
            } catch (error) {
                console.error('Error uninstalling device:', error);
                alert('Error: ' + error.message);
            }
        }
        
        async function testDevice(deviceType) {
            try {
                const response = await fetch('/api/devices/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ device_type: deviceType })
                });
                const data = await response.json();
                
                if (data.success) {
                    let message = `Test Result: ${data.message}\n\n`;
                    if (data.diagnostics && data.diagnostics.output) {
                        message += `Output:\n${data.diagnostics.output}\n`;
                    }
                    if (data.diagnostics && data.diagnostics.errors) {
                        message += `\nErrors:\n${data.diagnostics.errors}`;
                    }
                    alert(message);
                    
                    // Refresh devices to update status
                    refreshDevices();
                } else {
                    alert('Test failed: ' + data.message);
                }
            } catch (error) {
                console.error('Error testing device:', error);
                alert('Error: ' + error.message);
            }
        }
        
        function configureDevice(deviceId) {
            // TODO: Open configuration modal
            alert(`Device configuration for ${deviceId} - Coming soon!`);
        }
        
        // ==================== TERMINAL FUNCTIONS ====================
        
        let terminalHistory = [];
        
        async function executeTerminalCommand() {
            const input = document.getElementById('terminal-input');
            const command = input.value.trim();
            
            if (!command) return;
            
            const output = document.getElementById('terminal-output');
            output.textContent += `\n> ${command}\n`;
            
            try {
                const response = await fetch('/api/system/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ command: command })
                });
                const data = await response.json();
                
                if (data.success) {
                    output.textContent += data.output || '(no output)';
                    if (data.errors) {
                        output.textContent += `\n[ERROR] ${data.errors}`;
                    }
                } else {
                    output.textContent += `[ERROR] ${data.errors || 'Command failed'}\n`;
                }
            } catch (error) {
                output.textContent += `[ERROR] ${error.message}\n`;
            }
            
            output.scrollTop = output.scrollHeight;
            input.value = '';
            terminalHistory.push(command);
            
            updateCommandHistory();
        }
        
        function clearTerminal() {
            document.getElementById('terminal-output').textContent = 'FalconOne Terminal v1.7.0\nType \'help\' for available commands\nReady>\n';
        }
        
        function quickCommand(command) {
            document.getElementById('terminal-input').value = command;
            executeTerminalCommand();
        }
        
        async function updateCommandHistory() {
            try {
                const response = await fetch('/api/logs/terminal');
                const data = await response.json();
                
                if (data.success && data.entries) {
                    const historyDiv = document.getElementById('command-history');
                    historyDiv.innerHTML = data.entries.slice(-20).reverse().map(entry => `
                        <div style="padding: 8px; border-bottom: 1px solid var(--border-color); font-size: 12px;">
                            <div style="color: var(--text-secondary); font-size: 10px;">
                                ${new Date(entry.time * 1000).toLocaleString()}
                            </div>
                            <div style="color: var(--text-primary); font-family: monospace;">
                                ${entry.message}
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error fetching command history:', error);
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Load devices immediately
            refreshDevices();
            
            // Auto-refresh devices every 5 seconds
            setInterval(refreshDevices, 5000);
            
            // Update terminal logs every 3 seconds
            setInterval(updateCommandHistory, 3000);
        });

        // RANSacked Functions
        
        // HTML escaping function to prevent XSS
        function escapeHtml(text) {
            if (text == null) return '';
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return String(text).replace(/[&<>"']/g, m => map[m]);
        }
        
        // ==================== UNIFIED VULNERABILITY DATABASE FUNCTIONS ====================
        
        async function loadUnifiedDatabase() {
            const tableBody = document.getElementById('unified-exploits-table-body');
            const totalCount = document.getElementById('unified-total-count');
            const criticalCount = document.getElementById('unified-critical-count');
            const successRate = document.getElementById('unified-success-rate');
            const avgCvss = document.getElementById('unified-avg-cvss');
            const chainsCount = document.getElementById('unified-chains-count');
            
            // Show loading
            tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px;"><div class="loading-spinner" style="margin: 0 auto 10px;"></div>Loading database...</td></tr>';
            
            try {
                // Fetch statistics
                const statsResponse = await fetch('/api/exploits/stats');
                const statsData = await statsResponse.json();
                
                if (statsData.success) {
                    const stats = statsData.data;
                    totalCount.textContent = stats.total_exploits || 25;
                    criticalCount.textContent = stats.by_severity?.critical || '-';
                    successRate.textContent = Math.round((stats.average_success_rate || 0.81) * 100) + '%';
                    avgCvss.textContent = (stats.average_cvss || 7.48).toFixed(1);
                    chainsCount.textContent = stats.total_chains || 7;
                }
                
                // Fetch exploits list
                const listResponse = await fetch('/api/exploits/list', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ exploitable_only: true })
                });
                
                const listData = await listResponse.json();
                
                if (!listData.success) {
                    tableBody.innerHTML = `<tr><td colspan="8" style="text-align: center; padding: 20px; color: var(--danger);">Error: ${listData.error || 'Failed to load database'}</td></tr>`;
                    return;
                }
                
                window.unifiedExploits = listData.data.exploits || [];
                renderUnifiedExploits(window.unifiedExploits);
                
            } catch (error) {
                console.error('Error loading unified database:', error);
                tableBody.innerHTML = `<tr><td colspan="8" style="text-align: center; padding: 20px; color: var(--danger);">Network error: ${error.message}</td></tr>`;
            }
        }
        
        function renderUnifiedExploits(exploits) {
            const tableBody = document.getElementById('unified-exploits-table-body');
            
            if (exploits.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px; color: var(--text-secondary);">No exploits match your filters</td></tr>';
                return;
            }
            
            tableBody.innerHTML = exploits.map(exploit => {
                const cvssColor = exploit.cvss_score >= 9 ? 'var(--danger)' : 
                                 exploit.cvss_score >= 7 ? 'var(--warning)' : 
                                 'var(--info)';
                const successColor = exploit.success_rate >= 0.9 ? 'var(--success)' : 
                                    exploit.success_rate >= 0.7 ? 'var(--warning)' : 
                                    'var(--info)';
                
                return `
                    <tr style="border-bottom: 1px solid var(--border-color);">
                        <td style="padding: 12px; font-family: monospace; font-weight: bold; color: var(--primary-blue);">${escapeHtml(exploit.exploit_id)}</td>
                        <td style="padding: 12px;">${escapeHtml(exploit.name)}</td>
                        <td style="padding: 12px; font-size: 12px;">${escapeHtml(exploit.category).replace(/_/g, ' ')}</td>
                        <td style="padding: 12px; text-align: center;"><span style="color: ${cvssColor}; font-weight: bold;">${exploit.cvss_score.toFixed(1)}</span></td>
                        <td style="padding: 12px; text-align: center;"><span style="color: ${successColor}; font-weight: bold;">${Math.round(exploit.success_rate * 100)}%</span></td>
                        <td style="padding: 12px; font-size: 12px;">${escapeHtml(exploit.implementation)}</td>
                        <td style="padding: 12px; text-align: center;">
                            <button onclick="showExploitChains('${escapeHtml(exploit.exploit_id)}')" style="padding: 4px 10px; background: var(--accent-cyan); color: #000; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: bold;">View</button>
                        </td>
                        <td style="padding: 12px; text-align: center;">
                            <button onclick="executeExploitFromDB('${escapeHtml(exploit.exploit_id)}')" style="padding: 4px 12px; background: var(--success); color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: bold;">Execute</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function filterUnifiedExploits() {
            if (!window.unifiedExploits) {
                loadUnifiedDatabase();
                return;
            }
            
            const impl = document.getElementById('unified-impl-filter').value;
            const category = document.getElementById('unified-category-filter').value;
            const minCvss = parseFloat(document.getElementById('unified-cvss-filter').value) || 0;
            
            const filtered = window.unifiedExploits.filter(exploit => {
                if (impl && exploit.implementation !== impl) return false;
                if (category && exploit.category !== category) return false;
                if (exploit.cvss_score < minCvss) return false;
                return true;
            });
            
            renderUnifiedExploits(filtered);
        }
        
        async function showExploitChains(exploitId) {
            try {
                const response = await fetch(`/api/exploits/chains?exploit_id=${encodeURIComponent(exploitId)}`);
                const data = await response.json();
                
                if (!data.success) {
                    alert(`Error: ${data.error || 'Failed to fetch chains'}`);
                    return;
                }
                
                const chains = data.data.chains || [];
                
                if (chains.length === 0) {
                    alert(`No chains available for ${exploitId}`);
                    return;
                }
                
                let message = `Exploit Chains for ${exploitId}:

`;
                chains.forEach((chain, idx) => {
                    message += `Chain ${idx + 1}: ${chain.chain.join(' ‚Üí ')}
`;
                    message += `Success Rate: ${Math.round(chain.success_rate * 100)}%

`;
                });
                
                alert(message);
            } catch (error) {
                console.error('Error fetching chains:', error);
                alert(`Network error: ${error.message}`);
            }
        }
        
        async function executeExploitFromDB(exploitId) {
            const targetIp = prompt('Enter target IP address:', '192.168.1.100');
            if (!targetIp) return;
            
            const confirmed = confirm(`Execute ${exploitId} against ${targetIp}?

This will attempt to exploit the target system.`);
            if (!confirmed) return;
            
            try {
                const response = await fetch('/api/exploits/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        exploit_id: exploitId,
                        target: { ip_address: targetIp },
                        options: {}
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(`Exploit executed successfully!

Result: ${data.data.result || 'Success'}`);
                } else {
                    alert(`Exploit failed: ${data.error || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('Error executing exploit:', error);
                alert(`Network error: ${error.message}`);
            }
        }
        
        // ==================== AUTO-EXPLOIT ENGINE FUNCTIONS ====================
        
        async function runAutoExploit() {
            const targetIp = document.getElementById('auto-exploit-target-ip').value.trim();
            const implementation = document.getElementById('auto-exploit-impl').value;
            const version = document.getElementById('auto-exploit-version').value.trim();
            const chainingEnabled = document.getElementById('auto-exploit-chaining').checked;
            const postActions = document.getElementById('auto-exploit-post-actions').checked;
            const maxDepth = parseInt(document.getElementById('auto-exploit-max-depth').value) || 3;
            const resultsDiv = document.getElementById('auto-exploit-results');
            const timelineDiv = document.getElementById('auto-exploit-timeline');
            const summaryDiv = document.getElementById('auto-exploit-summary');
            const btn = document.getElementById('auto-exploit-btn');
            const icon = document.getElementById('auto-exploit-icon');
            
            if (!targetIp) {
                alert('Please enter a target IP address');
                return;
            }
            
            const confirmed = confirm(`Launch auto-exploit against ${targetIp}?

` +
                                    `This will:
` +
                                    `1. Fingerprint the target
` +
                                    `2. Query vulnerability database
` +
                                    `3. Select optimal exploit chain
` +
                                    `4. Execute exploits automatically

` +
                                    `Continue?`);
            if (!confirmed) return;
            
            // Show loading state
            btn.disabled = true;
            icon.textContent = '‚è≥';
            resultsDiv.style.display = 'block';
            timelineDiv.innerHTML = '<div style="padding: 10px; text-align: center;"><div class="loading-spinner" style="margin: 0 auto;"></div></div>';
            summaryDiv.innerHTML = '';
            
            try {
                const response = await fetch('/api/exploits/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        auto_exploit: true,
                        target: {
                            ip_address: targetIp,
                            implementation: implementation || undefined,
                            version: version || undefined
                        },
                        options: {
                            chaining_enabled: chainingEnabled,
                            post_exploit: postActions ? 'capture_imsi_continuous' : 'none',
                            max_chain_depth: maxDepth
                        }
                    })
                });
                
                const data = await response.json();
                
                // Update timeline
                timelineDiv.innerHTML = '';
                if (data.success && data.data.timeline) {
                    data.data.timeline.forEach((event, idx) => {
                        timelineDiv.innerHTML += `
                            <div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: var(--bg-dark); border-radius: 5px; border-left: 3px solid ${event.success ? 'var(--success)' : 'var(--danger)'};">
                                <div style="font-size: 20px;">${event.success ? '‚úÖ' : '‚ùå'}</div>
                                <div style="flex: 1;">
                                    <div style="font-weight: bold; color: var(--text-primary);">${escapeHtml(event.step)}</div>
                                    <div style="font-size: 12px; color: var(--text-secondary); margin-top: 3px;">${escapeHtml(event.description)}</div>
                                </div>
                                <div style="font-size: 11px; color: var(--text-secondary);">${event.timestamp || `Step ${idx + 1}`}</div>
                            </div>
                        `;
                    });
                } else {
                    timelineDiv.innerHTML = '<div style="padding: 10px; color: var(--text-secondary);">No timeline available</div>';
                }
                
                // Update summary
                if (data.success) {
                    const result = data.data;
                    summaryDiv.innerHTML = `
                        <div style="display: flex; justify-content: space-between; padding: 10px; background: var(--bg-dark); border-radius: 5px; border-left: 3px solid var(--success);">
                            <span style="color: var(--text-secondary);">Status:</span>
                            <span style="color: var(--success); font-weight: bold;">SUCCESS</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px; background: var(--bg-darker); border-radius: 5px;">
                            <span style="color: var(--text-secondary);">Exploits Executed:</span>
                            <span style="color: var(--text-primary); font-weight: 500;">${result.exploits_executed || 0}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px; background: var(--bg-darker); border-radius: 5px;">
                            <span style="color: var(--text-secondary);">Total Time:</span>
                            <span style="color: var(--text-primary); font-weight: 500;">${result.total_time || '-'}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px; background: var(--bg-darker); border-radius: 5px;">
                            <span style="color: var(--text-secondary);">IMSI Captured:</span>
                            <span style="color: var(--text-primary); font-weight: 500;">${result.imsi_captured || 0}</span>
                        </div>
                    `;
                } else {
                    summaryDiv.innerHTML = `
                        <div style="display: flex; justify-content: space-between; padding: 10px; background: var(--bg-dark); border-radius: 5px; border-left: 3px solid var(--danger);">
                            <span style="color: var(--text-secondary);">Status:</span>
                            <span style="color: var(--danger); font-weight: bold;">FAILED</span>
                        </div>
                        <div style="padding: 10px; background: var(--bg-dark); border-radius: 5px;">
                            <span style="color: var(--text-secondary);">Error:</span>
                            <span style="color: var(--danger); font-weight: 500; margin-left: 10px;">${data.error || 'Unknown error'}</span>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Error running auto-exploit:', error);
                timelineDiv.innerHTML = '<div style="padding: 10px; color: var(--danger);">Network error: ' + error.message + '</div>';
            } finally {
                btn.disabled = false;
                icon.textContent = 'üöÄ';
            }
        }
        
        function stopAutoExploit() {
            // TODO: Implement stop functionality via API
            alert('Stop auto-exploit functionality coming soon!');
        }
        
        function showExploitChainVisualization() {
            // TODO: Implement chain visualization with D3.js or Mermaid
            alert('Chain visualization coming soon!

This will show a flowchart of exploit chains with success rates.');
        }

        // RANSacked legacy functions removed - all exploits now accessible via unified API

        // Initialize map
        const map = L.map('map').setView([51.505, -0.09], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);
        
        // Initialize charts
        const throughputChart = new Chart(document.getElementById('throughput-chart'), {
            type: 'line',
            data: { labels: [], datasets: [{ label: 'Throughput (Mbps)', data: [], borderColor: '#4fc3f7', tension: 0.4 }] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#eee' } } }, scales: { y: { ticks: { color: '#eee' } }, x: { ticks: { color: '#eee' } } } }
        });
        
        const emissionsChart = new Chart(document.getElementById('emissions-chart'), {
            type: 'bar',
            data: { labels: ['CO2', 'Power', 'PUE'], datasets: [{ label: 'Metrics', data: [], backgroundColor: ['#4caf50', '#ff9800', '#2196f3'] }] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#eee' } } }, scales: { y: { ticks: { color: '#eee' } }, x: { ticks: { color: '#eee' } } } }
        });
        
        // Real-time data updates
        socket.on('kpis_update', function(data) {
            document.getElementById('kpis').innerHTML = `
                <div class="kpi">
                    <div class="kpi-label">Throughput</div>
                    <div class="kpi-value">${data.throughput_mbps?.toFixed(2)} Mbps</div>
                </div>
                <div class="kpi">
                    <div class="kpi-label">Latency</div>
                    <div class="kpi-value">${data.latency_ms?.toFixed(2)} ms</div>
                </div>
                <div class="kpi">
                    <div class="kpi-label">Success Rate</div>
                    <div class="kpi-value">${(data.success_rate * 100)?.toFixed(1)}%</div>
                </div>
                <div class="kpi">
                    <div class="kpi-label">Connections</div>
                    <div class="kpi-value">${data.active_connections}</div>
                </div>
            `;
        });
        
        socket.on('cellular_update', function(data) {
            if (data.gsm) {
                document.getElementById('cellular-gsm').innerHTML = `
                    <p><span class="status-indicator ${data.gsm.running ? 'status-active' : 'status-inactive'}"></span>
                    Status: ${data.gsm.running ? 'Active' : 'Inactive'}</p>
                    <p>Captures: <strong>${data.gsm.captures || 0}</strong></p>
                    <p>Band: <strong>${data.gsm.band || 'N/A'}</strong></p>
                `;
            }
            if (data.umts) {
                document.getElementById('cellular-umts').innerHTML = `
                    <p><span class="status-indicator ${data.umts.running ? 'status-active' : 'status-inactive'}"></span>
                    Status: ${data.umts.running ? 'Active' : 'Inactive'}</p>
                    <p>Captures: <strong>${data.umts.captures || 0}</strong></p>
                    <p>Bands: <strong>${Array.isArray(data.umts.bands) ? data.umts.bands.join(', ') : 'N/A'}</strong></p>
                `;
            }
            if (data.lte) {
                document.getElementById('cellular-lte').innerHTML = `
                    <p><span class="status-indicator ${data.lte.running ? 'status-active' : 'status-inactive'}"></span>
                    Status: ${data.lte.running ? 'Active' : 'Inactive'}</p>
                    <p>Captures: <strong>${data.lte.captures || 0}</strong></p>
                    <p>Bands: <strong>${Array.isArray(data.lte.bands) ? data.lte.bands.join(', ') : 'N/A'}</strong></p>
                `;
            }
            if (data.fiveg) {
                document.getElementById('cellular-5g').innerHTML = `
                    <p><span class="status-indicator ${data.fiveg.running ? 'status-active' : 'status-inactive'}"></span>
                    Status: ${data.fiveg.running ? 'Active' : 'Inactive'}</p>
                    <p>SUCI Count: <strong>${data.fiveg.suci_count || 0}</strong></p>
                    <p>NTN: <strong>${data.fiveg.ntn_enabled ? 'Enabled' : 'Disabled'}</strong></p>
                `;
            }
            if (data.sixg) {
                document.getElementById('cellular-6g').innerHTML = `
                    <p><span class="status-indicator ${data.sixg.running ? 'status-active' : 'status-inactive'}"></span>
                    Status: ${data.sixg.running ? 'Active' : 'Inactive'}</p>
                    <p>AI Features: <strong>${data.sixg.ai_enabled ? 'Enabled' : 'Disabled'}</strong></p>
                    <p>Semantic: <strong>${data.sixg.semantic_enabled ? 'Active' : 'Inactive'}</strong></p>
                `;
            }
        });
        
        socket.on('ntn_update', function(data) {
            const satHtml = data.satellites.map(sat => `
                <div style="border-left: 3px solid #2196f3; padding: 10px; margin: 8px 0; background: rgba(33, 150, 243, 0.1);">
                    <strong>${sat.name}</strong> (${sat.type})<br>
                    Altitude: ${sat.altitude}km | Coverage: ${sat.coverage}<br>
                    Status: <span class="badge badge-${sat.active ? 'success' : 'warning'}">${sat.active ? 'Active' : 'Standby'}</span>
                </div>
            `).join('');
            document.getElementById('ntn-satellites').innerHTML = satHtml || '<p>No satellites detected</p>';
        });
        
        socket.on('exploit_update', function(data) {
            if (data.crypto) {
                document.getElementById('exploit-crypto').innerHTML = `
                    <p>Active Attacks: <span class="badge badge-warning">${data.crypto.active_attacks || 0}</span></p>
                    <p>Vulnerabilities Found: <strong>${data.crypto.vulnerabilities || 0}</strong></p>
                    <p>Last Analysis: <small>${data.crypto.last_scan || 'Never'}</small></p>
                `;
            }
            if (data.ntn) {
                document.getElementById('exploit-ntn').innerHTML = `
                    <p>Satellite Exploits: <span class="badge badge-info">${data.ntn.exploits || 0}</span></p>
                    <p>Coverage Manipulation: <strong>${data.ntn.coverage_attacks || 0}</strong></p>
                    <p>Handover Attacks: <strong>${data.ntn.handover_attacks || 0}</strong></p>
                `;
            }
            if (data.v2x) {
                document.getElementById('exploit-v2x').innerHTML = `
                    <p>V2X Targets: <span class="badge badge-danger">${data.v2x.targets || 0}</span></p>
                    <p>Message Spoofing: <strong>${data.v2x.spoofing_active ? 'Active' : 'Inactive'}</strong></p>
                    <p>Safety Compromised: <strong>${data.v2x.safety_attacks || 0}</strong></p>
                `;
            }
            if (data.injection) {
                document.getElementById('exploit-injection').innerHTML = `
                    <p>Silent SMS Sent: <span class="badge badge-success">${data.injection.sms_sent || 0}</span></p>
                    <p>Success Rate: <strong>${data.injection.success_rate || 0}%</strong></p>
                    <p>Last Injection: <small>${data.injection.last_injection || 'Never'}</small></p>
                `;
            }
            if (data.silent_sms) {
                document.getElementById('silent-sms').innerHTML = `
                    <p>Tracked Targets: <span class="badge badge-info">${data.silent_sms.targets || 0}</span></p>
                    <p>Messages Monitored: <strong>${data.silent_sms.monitored || 0}</strong></p>
                    <p>Detection Rate: <strong>${data.silent_sms.detection_rate || 0}%</strong></p>
                `;
            }
            if (data.downgrade) {
                document.getElementById('downgrade-attacks').innerHTML = `
                    <p>Downgrade Attempts: <span class="badge badge-warning">${data.downgrade.attempts || 0}</span></p>
                    <p>5G‚Üí4G: <strong>${data.downgrade.fiveg_to_lte || 0}</strong> | 4G‚Üí3G: <strong>${data.downgrade.lte_to_umts || 0}</strong></p>
                    <p>Success Rate: <strong>${data.downgrade.success_rate || 0}%</strong></p>
                `;
            }
            if (data.paging) {
                document.getElementById('paging-spoof').innerHTML = `
                    <p>Paging Spoofs: <span class="badge badge-danger">${data.paging.spoofs || 0}</span></p>
                    <p>Targets Tracked: <strong>${data.paging.targets_tracked || 0}</strong></p>
                    <p>Location Accuracy: <strong>${data.paging.accuracy || 0}%</strong></p>
                `;
            }
            if (data.aiot) {
                document.getElementById('aiot-exploits').innerHTML = `
                    <p>A-IoT Devices: <span class="badge badge-info">${data.aiot.devices || 0}</span></p>
                    <p>Ambient Sensors: <strong>${data.aiot.sensors || 0}</strong></p>
                    <p>Battery-Free Exploits: <strong>${data.aiot.exploits || 0}</strong></p>
                `;
            }
            if (data.semantic) {
                document.getElementById('semantic-6g').innerHTML = `
                    <p>Semantic Attacks: <span class="badge badge-warning">${data.semantic.attacks || 0}</span></p>
                    <p>AI Model Poisoning: <strong>${data.semantic.poisoning || 0}</strong></p>
                    <p>Context Manipulation: <strong>${data.semantic.context_attacks || 0}</strong></p>
                `;
            }
        });
        
        socket.on('analytics_update', function(data) {
            if (data.fusion) {
                document.getElementById('analytics-fusion').innerHTML = `
                    <p>Fusion Score: <span class="badge badge-success">${data.fusion.score || 0}/100</span></p>
                    <p>RF Anomalies: <strong>${data.fusion.rf_anomalies || 0}</strong></p>
                    <p>Cyber Threats: <strong>${data.fusion.cyber_threats || 0}</strong></p>
                `;
            }
            if (data.classifier) {
                document.getElementById('analytics-classifier').innerHTML = `
                    <p>Signals Classified: <span class="badge badge-info">${data.classifier.signals || 0}</span></p>
                    <p>Accuracy: <strong>${data.classifier.accuracy || 0}%</strong></p>
                    <p>Model: <strong>${data.classifier.model || 'TensorFlow CNN'}</strong></p>
                `;
            }
            if (data.ric) {
                document.getElementById('analytics-ric').innerHTML = `
                    <p>xApps Active: <span class="badge badge-success">${data.ric.xapps || 0}</span></p>
                    <p>Optimization Score: <strong>${data.ric.optimization || 0}%</strong></p>
                    <p>QoS Improvements: <strong>+${data.ric.qos_gain || 0}%</strong></p>
                `;
            }
            if (data.geolocation) {
                document.getElementById('precision-geo').innerHTML = `
                    <p>Precision: <span class="badge badge-success">${data.geolocation.precision || 0}m</span></p>
                    <p>Targets Geolocated: <strong>${data.geolocation.targets || 0}</strong></p>
                    <p>Method: <strong>${data.geolocation.method || 'TDOA + ML'}</strong></p>
                `;
            }
            if (data.validator) {
                document.getElementById('data-validator').innerHTML = `
                    <p>Data Quality: <span class="badge badge-${data.validator.quality > 80 ? 'success' : 'warning'}">${data.validator.quality || 0}%</span></p>
                    <p>Avg SNR: <strong>${data.validator.avg_snr || 0} dB</strong></p>
                    <p>Invalid Samples: <strong>${data.validator.invalid || 0}</strong></p>
                `;
            }
        });
        
        socket.on('agents_update', function(agents) {
            const agentHtml = agents.map(agent => `
                <div style="border-left: 3px solid #4caf50; padding: 10px; margin: 8px 0; background: rgba(76, 175, 80, 0.1);">
                    <strong>Agent ${agent.agent_id}</strong><br>
                    Status: <span class="badge badge-${agent.status === 'active' ? 'success' : 'warning'}">${agent.status}</span><br>
                    Reward: ${agent.reward?.toFixed(2) || 0} | Episodes: ${agent.episodes || 0}
                </div>
            `).join('');
            document.getElementById('agents').innerHTML = agentHtml || '<p>No federated agents running</p>';
        });
        
        socket.on('emissions_update', function(data) {
            document.getElementById('emissions').innerHTML = `
                <p>CO2 Emissions: <strong>${data.co2_kg?.toFixed(2) || 0} kg</strong></p>
                <p>Power Usage: <strong>${data.power_kwh?.toFixed(2) || 0} kWh</strong></p>
                <p>PUE: <strong>${data.pue?.toFixed(2) || 0}</strong></p>
            `;
            if (emissionsChart) {
                emissionsChart.data.datasets[0].data = [data.co2_kg || 0, data.power_kwh || 0, data.pue || 0];
                emissionsChart.update();
            }
        });
        
        socket.on('sdr_update', function(devices) {
            const sdrHtml = devices.map(dev => `
                <div style="border-left: 3px solid #ff9800; padding: 10px; margin: 8px 0; background: rgba(255, 152, 0, 0.1);">
                    <strong>${dev.name}</strong> (${dev.type})<br>
                    Status: <span class="badge badge-${dev.active ? 'success' : 'danger'}">${dev.active ? 'Active' : 'Offline'}</span><br>
                    Frequency: ${dev.frequency || 'N/A'} | Gain: ${dev.gain || 0} dB
                </div>
            `).join('');
            document.getElementById('sdr-devices').innerHTML = sdrHtml || '<p>No SDR devices detected</p>';
        });
        
        socket.on('targets_update', function(targets) {
            const targetHtml = `<table class="data-table">
                <thead><tr><th>ID</th><th>Type</th><th>IMSI</th><th>Status</th><th>Last Seen</th></tr></thead>
                <tbody>${targets.map(t => `
                    <tr>
                        <td>${t.target_id}</td>
                        <td><span class="badge badge-info">${t.type}</span></td>
                        <td>${t.imsi || 'N/A'}</td>
                        <td><span class="badge badge-${t.active ? 'success' : 'warning'}">${t.active ? 'Active' : 'Idle'}</span></td>
                        <td><small>${t.last_seen || 'Never'}</small></td>
                    </tr>
                `).join('')}</tbody>
            </table>`;
            document.getElementById('targets').innerHTML = targetHtml || '<p>No targets managed</p>';
        });
        
        socket.on('security_audit_update', function(audit) {
            const auditHtml = `
                <div class="alert ${audit.severity}">
                    <strong>${audit.title}</strong><br>
                    ${audit.description}<br>
                    <small>Severity: ${audit.severity} | Timestamp: ${audit.timestamp}</small>
                </div>
            `;
            document.getElementById('security-audit').insertAdjacentHTML('afterbegin', auditHtml);
        });
        
        socket.on('voice_call_update', function(call) {
            const callDiv = document.createElement('div');
            callDiv.className = 'alert medium';
            callDiv.innerHTML = `
                <strong>Call Intercepted</strong>: ${call.caller} ‚Üí ${call.callee}<br>
                Duration: ${call.duration}s | Quality: ${call.quality} | Type: ${call.type}<br>
                <small>${call.timestamp}</small>
            `;
            document.getElementById('voice-calls').prepend(callDiv);
        });
        
        socket.on('error_recovery_update', function(event) {
            const eventDiv = document.createElement('div');
            eventDiv.className = 'alert ' + (event.recovered ? 'low' : 'medium');
            eventDiv.innerHTML = `
                <strong>${event.error_type}</strong>: ${event.description}<br>
                Status: <span class="badge badge-${event.recovered ? 'success' : 'warning'}">${event.recovered ? 'Recovered' : 'Pending'}</span><br>
                <small>${event.timestamp}</small>
            `;
            document.getElementById('error-recovery').prepend(eventDiv);
        });
        
        socket.on('config_update', function(config) {
            document.getElementById('config-management').innerHTML = `
                <p>Refresh Rate: <strong>${config.refresh_rate_ms}ms</strong></p>
                <p>Auth Enabled: <strong>${config.auth_enabled ? 'Yes' : 'No'}</strong></p>
                <p>Host: <strong>${config.host}:${config.port}</strong></p>
                <button class="btn" onclick="alert('Config editor coming soon')">‚öôÔ∏è Edit Config</button>
            `;
        });
        
        socket.on('regulatory_update', function(data) {
            document.getElementById('regulatory-scanner').innerHTML = `
                <p>Compliance Score: <span class="badge badge-${data.score > 80 ? 'success' : 'warning'}">${data.score || 0}%</span></p>
                <p>Violations: <strong>${data.violations || 0}</strong></p>
                <p>Last Scan: <small>${data.last_scan || 'Never'}</small></p>
                <p>Regions: <strong>${Array.isArray(data.regions) ? data.regions.join(', ') : 'N/A'}</strong></p>
            `;
        });
        
        socket.on('quick_status_update', function(status) {
            // Update header counts
            document.getElementById('header-device-count').textContent = 
                (status.sdr_active || 0) + '/' + (status.sdr_total || 0);
            document.getElementById('header-alert-count').textContent = 
                status.alerts_unack || 0;
            
            // Update quick status panel
            document.getElementById('quick-status').innerHTML = `
                <p>üéØ Targets: <strong>${status.targets || 0}</strong></p>
                <p>üì° SDR Devices: <strong>${status.sdr_active || 0}/${status.sdr_total || 0}</strong></p>
                <p>‚ö° Exploits Running: <strong>${status.exploits_active || 0}</strong></p>
                <p>üîê SUCI Captured: <strong>${status.suci_count || 0}</strong></p>
                <p>üìû Calls Intercepted: <strong>${status.voice_calls || 0}</strong></p>
            `;
        });
        
        socket.on('suci_capture', function(capture) {
            const captureDiv = document.createElement('div');
            captureDiv.className = 'alert low';
            captureDiv.innerHTML = `
                <strong>${capture.generation}</strong>: ${capture.suci} 
                ${capture.deconcealed ? '‚ûú <span class="badge-success badge">' + capture.imsi + '</span>' : '<span class="badge-warning badge">Pending</span>'}
                <small style="float:right">${capture.timestamp_human}</small>
            `;
            document.getElementById('suci-captures').prepend(captureDiv);
        });
        
        socket.on('anomaly_alert', function(alert) {
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert ' + alert.severity;
            alertDiv.innerHTML = `<strong>${alert.severity.toUpperCase()}:</strong> ${alert.description} <small style="float:right">${alert.timestamp_human}</small>`;
            document.getElementById('anomalies').prepend(alertDiv);
        });
        
        socket.on('geolocation_update', function(location) {
            L.marker([location.latitude, location.longitude])
                .addTo(map)
                .bindPopup(`${location.type}: ${JSON.stringify(location.metadata)}`);
        });
        
        socket.on('health_update', function(health) {
            // Format uptime
            const days = Math.floor(health.uptime_seconds / 86400);
            const hours = Math.floor((health.uptime_seconds % 86400) / 3600);
            const minutes = Math.floor((health.uptime_seconds % 3600) / 60);
            const uptimeStr = days > 0 ? `${days}d ${hours}h ${minutes}m` : `${hours}h ${minutes}m`;
            
            // Format memory sizes
            const memUsed = (health.memory.used_mb / 1024).toFixed(1);
            const memTotal = (health.memory.total_mb / 1024).toFixed(1);
            const diskUsed = health.disk.used_gb?.toFixed(1) || 0;
            const diskTotal = health.disk.total_gb?.toFixed(1) || 0;
            
            // Build alerts HTML
            let alertsHTML = '';
            if (health.alerts && health.alerts.length > 0) {
                alertsHTML = '<div style="margin-top: 15px;">';
                health.alerts.forEach(alert => {
                    const color = alert.level === 'critical' ? '#ff3b30' : '#ff9500';
                    const icon = alert.level === 'critical' ? 'üî¥' : '‚ö†Ô∏è';
                    alertsHTML += `<div style="padding: 8px; background: rgba(255,59,48,0.1); border-left: 3px solid ${color}; margin-bottom: 8px; border-radius: 4px;">
                        ${icon} <strong style="color: ${color}; text-transform: uppercase;">${alert.level}:</strong> ${alert.message}
                    </div>`;
                });
                alertsHTML += '</div>';
            }
            
            // Build temperature HTML
            let tempHTML = '';
            if (health.temperature && Object.keys(health.temperature).length > 0) {
                tempHTML = '<div style="margin-top: 20px;"><h3 style="margin-bottom: 10px;">üå°Ô∏è Temperature</h3>';
                for (const [sensor, readings] of Object.entries(health.temperature)) {
                    readings.forEach(reading => {
                        const tempColor = reading.current > 80 ? '#ff3b30' : reading.current > 60 ? '#ff9500' : '#30d158';
                        tempHTML += `<div style="margin: 5px 0;"><span style="color: #888;">${reading.label}:</span> 
                            <strong style="color: ${tempColor};">${reading.current?.toFixed(1)}¬∞C</strong>`;
                        if (reading.high) tempHTML += ` <span style="color: #888; font-size: 12px;">(max: ${reading.high}¬∞C)</span>`;
                        tempHTML += `</div>`;
                    });
                }
                tempHTML += '</div>';
            }
            
            // Build per-core CPU HTML
            let perCoreHTML = '';
            if (health.cpu.per_core && health.cpu.per_core.length > 0) {
                perCoreHTML = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 8px; margin-top: 10px;">';
                health.cpu.per_core.forEach((usage, i) => {
                    const barColor = usage > 80 ? '#ff3b30' : usage > 60 ? '#ff9500' : '#00e5ff';
                    perCoreHTML += `<div style="background: var(--bg-dark); padding: 8px; border-radius: 6px;">
                        <div style="font-size: 11px; color: #888; margin-bottom: 4px;">Core ${i}</div>
                        <div style="background: rgba(0,0,0,0.5); height: 6px; border-radius: 3px; overflow: hidden;">
                            <div style="width: ${usage}%; height: 100%; background: ${barColor}; transition: width 0.3s;"></div>
                        </div>
                        <div style="font-size: 11px; margin-top: 2px;">${usage?.toFixed(0)}%</div>
                    </div>`;
                });
                perCoreHTML += '</div>';
            }
            
            // Build network throughput
            const uploadMbps = health.network.upload_mbps?.toFixed(2) || '0.00';
            const downloadMbps = health.network.download_mbps?.toFixed(2) || '0.00';
            const uploadKbps = health.network.upload_kbps?.toFixed(1) || '0.0';
            const downloadKbps = health.network.download_kbps?.toFixed(1) || '0.0';
            
            // Build process info
            const processCPU = health.process.cpu_percent?.toFixed(1) || '0.0';
            const processMemMB = health.process.memory_mb?.toFixed(1) || '0.0';
            const processMemGB = (health.process.memory_mb / 1024)?.toFixed(2) || '0.00';
            const pythonCount = health.process.python_count || 0;
            const numThreads = health.process.num_threads || 0;
            
            document.getElementById('system-health').innerHTML = `
                ${alertsHTML}
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 15px;">
                    <!-- CPU Section -->
                    <div>
                        <h3 style="margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                            <span>üíª</span> CPU Usage
                            <span style="font-size: 14px; font-weight: normal; color: #888;">${health.cpu.cores_physical || health.cpu.cores_logical || 0} cores</span>
                        </h3>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${health.cpu.usage_percent}%; background: ${health.cpu.usage_percent > 80 ? '#ff3b30' : health.cpu.usage_percent > 60 ? '#ff9500' : '#00e5ff'};">
                                ${health.cpu.usage_percent?.toFixed(1)}%
                            </div>
                        </div>
                        <div style="margin-top: 8px; font-size: 13px; color: #888;">
                            <div>Frequency: <strong style="color: #fff;">${health.cpu.frequency_current_mhz?.toFixed(0) || 0} MHz</strong></div>
                            ${health.cpu.load_average && health.cpu.load_average.length > 0 ? 
                                `<div>Load Avg: <strong style="color: #fff;">${health.cpu.load_average[0]?.toFixed(2)}, ${health.cpu.load_average[1]?.toFixed(2)}, ${health.cpu.load_average[2]?.toFixed(2)}</strong></div>` : ''}
                        </div>
                        ${perCoreHTML}
                    </div>
                    
                    <!-- Memory Section -->
                    <div>
                        <h3 style="margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                            <span>üß†</span> Memory
                            <span style="font-size: 14px; font-weight: normal; color: #888;">${memUsed} / ${memTotal} GB</span>
                        </h3>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${health.memory.percent}%; background: ${health.memory.percent > 80 ? '#ff3b30' : health.memory.percent > 60 ? '#ff9500' : '#30d158'};">
                                ${health.memory.percent?.toFixed(1)}%
                            </div>
                        </div>
                        <div style="margin-top: 8px; font-size: 13px; color: #888;">
                            <div>Available: <strong style="color: #30d158;">${(health.memory.available_mb / 1024)?.toFixed(1) || 0} GB</strong></div>
                            <div>Cached: <strong style="color: #888;">${(health.memory.cached_mb / 1024)?.toFixed(1) || 0} GB</strong></div>
                            ${health.memory.swap_total_mb > 0 ? 
                                `<div style="margin-top: 6px;">Swap: <strong style="color: ${health.memory.swap_percent > 50 ? '#ff9500' : '#fff'};">${health.memory.swap_percent?.toFixed(1)}%</strong> (${(health.memory.swap_used_mb / 1024)?.toFixed(1)} / ${(health.memory.swap_total_mb / 1024)?.toFixed(1)} GB)</div>` : ''}
                        </div>
                    </div>
                    
                    <!-- Disk Section -->
                    <div>
                        <h3 style="margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                            <span>üíæ</span> Disk
                            <span style="font-size: 14px; font-weight: normal; color: #888;">${diskUsed} / ${diskTotal} GB</span>
                        </h3>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${health.disk.percent}%; background: ${health.disk.percent > 80 ? '#ff3b30' : health.disk.percent > 60 ? '#ff9500' : '#bf5af2'};">
                                ${health.disk.percent?.toFixed(1)}%
                            </div>
                        </div>
                        <div style="margin-top: 8px; font-size: 13px; color: #888;">
                            <div>Free: <strong style="color: #30d158;">${health.disk.free_gb?.toFixed(1) || 0} GB</strong></div>
                            ${health.disk.read_mb !== undefined ? 
                                `<div style="margin-top: 6px;">Read: <strong style="color: #00e5ff;">${health.disk.read_mb?.toFixed(1)} MB</strong></div>
                                <div>Write: <strong style="color: #ff9500;">${health.disk.write_mb?.toFixed(1)} MB</strong></div>` : ''}
                        </div>
                    </div>
                    
                    <!-- Network Section -->
                    <div>
                        <h3 style="margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                            <span>üåê</span> Network
                        </h3>
                        <div style="margin-top: 8px; font-size: 13px;">
                            <div style="padding: 8px; background: rgba(0,229,255,0.1); border-radius: 6px; margin-bottom: 8px;">
                                <div style="color: #00e5ff; font-size: 12px;">‚ñº DOWNLOAD</div>
                                <div style="font-size: 16px; font-weight: 600; margin-top: 4px;">${downloadMbps} <span style="font-size: 13px; font-weight: normal;">Mbps</span></div>
                                <div style="color: #888; font-size: 11px;">${downloadKbps} KB/s</div>
                            </div>
                            <div style="padding: 8px; background: rgba(255,149,0,0.1); border-radius: 6px;">
                                <div style="color: #ff9500; font-size: 12px;">‚ñ≤ UPLOAD</div>
                                <div style="font-size: 16px; font-weight: 600; margin-top: 4px;">${uploadMbps} <span style="font-size: 13px; font-weight: normal;">Mbps</span></div>
                                <div style="color: #888; font-size: 11px;">${uploadKbps} KB/s</div>
                            </div>
                            ${health.network.errors_in > 0 || health.network.errors_out > 0 ? 
                                `<div style="margin-top: 8px; color: #ff3b30; font-size: 12px;">‚ö†Ô∏è Errors: ${health.network.errors_in + health.network.errors_out}</div>` : ''}
                        </div>
                    </div>
                </div>
                
                <!-- Process Information -->
                <div style="margin-top: 20px; padding: 15px; background: var(--bg-dark); border-radius: 8px;">
                    <h3 style="margin-bottom: 10px;">‚öôÔ∏è Process Information</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; font-size: 13px;">
                        <div>
                            <div style="color: #888;">PID</div>
                            <div style="font-weight: 600;">${health.process.pid || 'N/A'}</div>
                        </div>
                        <div>
                            <div style="color: #888;">CPU Usage</div>
                            <div style="font-weight: 600; color: ${processCPU > 50 ? '#ff9500' : '#30d158'};">${processCPU}%</div>
                        </div>
                        <div>
                            <div style="color: #888;">Memory Usage</div>
                            <div style="font-weight: 600; color: ${processMemMB > 500 ? '#ff9500' : '#30d158'};">${processMemGB} GB</div>
                        </div>
                        <div>
                            <div style="color: #888;">Threads</div>
                            <div style="font-weight: 600;">${numThreads}</div>
                        </div>
                        <div>
                            <div style="color: #888;">Python Processes</div>
                            <div style="font-weight: 600;">${pythonCount}</div>
                        </div>
                        <div>
                            <div style="color: #888;">Uptime</div>
                            <div style="font-weight: 600; color: #00e5ff;">${uptimeStr}</div>
                        </div>
                    </div>
                </div>
                
                ${tempHTML}
            `;
        });
        
        // ==================== v1.7.0 PHASE 1 DATA HANDLERS ====================
        
        // Fetch and display environmental adaptation data
        function updateEnvironmentalAdaptation() {
            fetch('/api/environmental_adaptation')
                .then(r => r.json())
                .then(data => {
                    const statusClass = data.enabled ? 'status-active' : 'status-inactive';
                    if (data.enabled) {
                        document.getElementById('environmental-adaptation').innerHTML = `
                            <p><span class="status-indicator ${statusClass}"></span>Status: <strong>Enabled</strong></p>
                            <p>üåÜ Multipath Compensation: <span class="badge badge-${data.multipath_compensation ? 'success' : 'warning'}">${data.multipath_compensation ? 'ON' : 'OFF'}</span></p>
                            <p>üéØ Kalman Filter: <span class="badge badge-${data.kalman_filter_active ? 'success' : 'warning'}">${data.kalman_filter_active ? 'Active' : 'Inactive'}</span></p>
                            <p>üõ∞Ô∏è NTN Doppler Correction: <span class="badge badge-${data.ntn_doppler_correction ? 'success' : 'warning'}">${data.ntn_doppler_correction ? 'ON' : 'OFF'}</span></p>
                            <p>üìä Accuracy Improvement: <strong>+${data.accuracy_improvement_percent?.toFixed(1)}%</strong> <span class="badge badge-success">Target: +20-30%</span></p>
                            <p>üìç Current: ${data.current_conditions?.urban ? 'Urban' : 'Rural'}, Weather: ${data.current_conditions?.weather || 'N/A'}</p>
                            <p>üõ∞Ô∏è Satellites Visible: <strong>${data.current_conditions?.satellite_visibility || 0}</strong></p>
                        `;
                    } else {
                        document.getElementById('environmental-adaptation').innerHTML = `<p><span class="status-indicator status-inactive"></span>Not initialized</p>`;
                    }
                });
        }
        
        // Fetch and display profiling metrics
        function updateProfilingMetrics() {
            fetch('/api/profiling_metrics')
                .then(r => r.json())
                .then(data => {
                    const statusClass = data.enabled ? 'status-active' : 'status-inactive';
                    if (data.enabled) {
                        document.getElementById('profiling-metrics').innerHTML = `
                            <p><span class="status-indicator ${statusClass}"></span>Status: <strong>Enabled</strong></p>
                            <p>üìä Prometheus: <a href="${data.prometheus_endpoint}" target="_blank" class="badge badge-info">View Metrics</a></p>
                            <p>üìà Grafana: <a href="${data.grafana_dashboard}" target="_blank" class="badge badge-info">View Dashboard</a></p>
                            <h4 style="margin-top: 10px;">Latency Metrics</h4>
                            <p>p50: <strong>${data.latency_metrics?.p50_ms?.toFixed(2)} ms</strong></p>
                            <p>p95: <strong>${data.latency_metrics?.p95_ms?.toFixed(2)} ms</strong></p>
                            <p>p99: <strong>${data.latency_metrics?.p99_ms?.toFixed(2)} ms</strong></p>
                            <h4 style="margin-top: 10px;">Accuracy Metrics</h4>
                            <p>Signal Classification: <span class="badge badge-success">${(data.accuracy_metrics?.signal_classification * 100)?.toFixed(1)}%</span></p>
                            <p>Geolocation: <span class="badge badge-success">${(data.accuracy_metrics?.geolocation * 100)?.toFixed(1)}%</span></p>
                            <p>Operations Tracked: <strong>${data.operations_tracked || 0}</strong></p>
                        `;
                    } else {
                        document.getElementById('profiling-metrics').innerHTML = `<p><span class="status-indicator status-inactive"></span>Not initialized</p>`;
                    }
                });
        }
        
        // Fetch and display E2E validation status
        function updateE2EValidation() {
            fetch('/api/e2e_validation')
                .then(r => r.json())
                .then(data => {
                    const statusClass = data.enabled ? 'status-active' : 'status-inactive';
                    if (data.enabled) {
                        const chains = data.chains || {};
                        document.getElementById('e2e-validation').innerHTML = `
                            <p><span class="status-indicator ${statusClass}"></span>Status: <strong>Enabled</strong></p>
                            <p>üéØ Overall Coverage: <strong>${data.overall_coverage?.toFixed(1)}%</strong> <span class="badge badge-success">Target: >95%</span></p>
                            <h4 style="margin-top: 10px;">Test Chains</h4>
                            <p>üì° PDCCH: <span class="badge badge-${chains.pdcch?.status === 'passed' ? 'success' : 'danger'}">${chains.pdcch?.status || 'N/A'}</span> (${chains.pdcch?.coverage?.toFixed(1)}%)</p>
                            <p>ü§ñ A-IoT: <span class="badge badge-${chains.aiot?.status === 'passed' ? 'success' : 'danger'}">${chains.aiot?.status || 'N/A'}</span> (${chains.aiot?.coverage?.toFixed(1)}%)</p>
                            <p>üõ∞Ô∏è NTN: <span class="badge badge-${chains.ntn?.status === 'passed' ? 'success' : 'danger'}">${chains.ntn?.status || 'N/A'}</span> (${chains.ntn?.coverage?.toFixed(1)}%)</p>
                            <p>üîê Crypto: <span class="badge badge-${chains.crypto?.status === 'passed' ? 'success' : 'danger'}">${chains.crypto?.status || 'N/A'}</span> (${chains.crypto?.coverage?.toFixed(1)}%)</p>
                            <p>Tests Run: <strong>${data.tests_run || 0}</strong> | Passed: <strong>${data.tests_passed || 0}</strong></p>
                            <p>Last Run: <small>${new Date(data.last_run * 1000).toLocaleString()}</small></p>
                            <p>CI/CD: <span class="badge badge-${data.ci_cd_integrated ? 'success' : 'warning'}">${data.ci_cd_integrated ? 'Integrated' : 'Not Integrated'}</span></p>
                        `;
                    } else {
                        document.getElementById('e2e-validation').innerHTML = `<p><span class="status-indicator status-inactive"></span>Not initialized</p>`;
                    }
                });
        }
        
        // Fetch and display Model Zoo status
        function updateModelZoo() {
            fetch('/api/model_zoo')
                .then(r => r.json())
                .then(data => {
                    const statusClass = data.enabled ? 'status-active' : 'status-inactive';
                    if (data.enabled) {
                        let modelsHTML = '';
                        if (data.models && data.models.length > 0) {
                            modelsHTML = '<table class="data-table"><tr><th>Model</th><th>Task</th><th>Accuracy</th><th>Size</th></tr>';
                            data.models.forEach(m => {
                                modelsHTML += `<tr>
                                    <td>${m.name}</td>
                                    <td><span class="badge badge-info">${m.task}</span></td>
                                    <td>${(m.accuracy * 100)?.toFixed(1)}%</td>
                                    <td>${m.size_mb?.toFixed(1)} MB</td>
                                </tr>`;
                            });
                            modelsHTML += '</table>';
                        }
                        document.getElementById('model-zoo').innerHTML = `
                            <p><span class="status-indicator ${statusClass}"></span>Status: <strong>Enabled</strong></p>
                            <p>üì¶ Total Models: <strong>${data.total_models || 0}</strong></p>
                            <h4 style="margin-top: 10px;">Quantization</h4>
                            <p>Types: <span class="badge badge-info">INT8</span> <span class="badge badge-info">float16</span> <span class="badge badge-info">TFLite</span></p>
                            <p>Avg Size Reduction: <strong>${data.quantization?.avg_size_reduction}x</strong> <span class="badge badge-success">Target: 4x</span></p>
                            <p>Avg Speedup: <strong>${data.quantization?.avg_speedup}x</strong> <span class="badge badge-success">Target: 2-3x</span></p>
                            <p>Cache Dir: <small>${data.cache_dir}</small></p>
                            <h4 style="margin-top: 10px;">Registered Models</h4>
                            ${modelsHTML}
                        `;
                    } else {
                        document.getElementById('model-zoo').innerHTML = `<p><span class="status-indicator status-inactive"></span>Not initialized</p>`;
                    }
                });
        }
        
        // Fetch and display error recovery status
        function updateErrorRecoveryStatus() {
            fetch('/api/error_recovery_status')
                .then(r => r.json())
                .then(data => {
                    const statusClass = data.enabled ? 'status-active' : 'status-inactive';
                    if (data.enabled) {
                        const cb = data.circuit_breakers || {};
                        document.getElementById('error-recovery-status').innerHTML = `
                            <p><span class="status-indicator ${statusClass}"></span>Status: <strong>Enabled</strong></p>
                            <p>‚è±Ô∏è Uptime: <strong>${data.uptime_percent?.toFixed(2)}%</strong> <span class="badge badge-success">Target: >99%</span></p>
                            <p>üîÑ Avg Recovery Time: <strong>${data.avg_recovery_time_sec?.toFixed(1)}s</strong> <span class="badge badge-success">Target: <10s</span></p>
                            <p>üìä Total Recoveries: <strong>${data.total_recoveries || 0}</strong></p>
                            <h4 style="margin-top: 10px;">Circuit Breakers</h4>
                            <p>üì° SDR Reconnect: <span class="badge badge-${cb.sdr_reconnect?.status === 'closed' ? 'success' : 'danger'}">${cb.sdr_reconnect?.status || 'N/A'}</span> (${cb.sdr_reconnect?.failures || 0} failures)</p>
                            <p>üíª GPU Fallback: <span class="badge badge-${cb.gpu_fallback?.status === 'closed' ? 'success' : 'danger'}">${cb.gpu_fallback?.status || 'N/A'}</span> (${cb.gpu_fallback?.failures || 0} failures)</p>
                            <p>üåê Network Retry: <span class="badge badge-${cb.network_retry?.status === 'closed' ? 'success' : 'danger'}">${cb.network_retry?.status || 'N/A'}</span> (${cb.network_retry?.failures || 0} failures)</p>
                            <p>üíæ Checkpoint: <span class="badge badge-${data.checkpoint_enabled ? 'success' : 'warning'}">${data.checkpoint_enabled ? 'Enabled' : 'Disabled'}</span></p>
                        `;
                    } else {
                        document.getElementById('error-recovery-status').innerHTML = `<p><span class="status-indicator status-inactive"></span>Not initialized</p>`;
                    }
                });
        }
        
        // Fetch and display data validation stats
        function updateDataValidation() {
            fetch('/api/data_validation_stats')
                .then(r => r.json())
                .then(data => {
                    const statusClass = data.enabled ? 'status-active' : 'status-inactive';
                    if (data.enabled) {
                        const stats = data.statistics || {};
                        document.getElementById('data-validation').innerHTML = `
                            <p><span class="status-indicator ${statusClass}"></span>Status: <strong>Enabled</strong></p>
                            <p>üéöÔ∏è Validation Level: <span class="badge badge-info">${data.validation_level || 'N/A'}</span></p>
                            <p>üìä SNR Threshold: <strong>${data.snr_threshold_db || 0} dB</strong></p>
                            <p>‚úÖ DC Offset Removal: <span class="badge badge-${data.dc_offset_removal ? 'success' : 'warning'}">${data.dc_offset_removal ? 'ON' : 'OFF'}</span></p>
                            <p>‚úÖ Clipping Detection: <span class="badge badge-${data.clipping_detection ? 'success' : 'warning'}">${data.clipping_detection ? 'ON' : 'OFF'}</span></p>
                            <p>üìâ False Positive Reduction: <strong>${data.false_positive_reduction_percent?.toFixed(1)}%</strong> <span class="badge badge-success">Target: 10-15%</span></p>
                            <h4 style="margin-top: 10px;">Statistics</h4>
                            <p>Samples Validated: <strong>${stats.samples_validated || 0}</strong></p>
                            <p>Passed: <span class="badge badge-success">${stats.samples_passed || 0}</span></p>
                            <p>Rejected: <span class="badge badge-danger">${stats.samples_rejected || 0}</span></p>
                            <p>Avg SNR: <strong>${stats.avg_snr_db?.toFixed(1)} dB</strong></p>
                        `;
                    } else {
                        document.getElementById('data-validation').innerHTML = `<p><span class="status-indicator status-inactive"></span>Not initialized</p>`;
                    }
                });
        }
        
        // Fetch and display performance stats
        function updatePerformanceStats() {
            fetch('/api/performance_stats')
                .then(r => r.json())
                .then(data => {
                    const statusClass = data.enabled ? 'status-active' : 'status-inactive';
                    if (data.enabled) {
                        const caching = data.caching || {};
                        const pooling = data.pooling || {};
                        const fft = data.fft || {};
                        document.getElementById('performance-stats').innerHTML = `
                            <p><span class="status-indicator ${statusClass}"></span>Status: <strong>Enabled</strong></p>
                            <p>üöÄ CPU Reduction: <strong>${data.cpu_reduction_percent?.toFixed(1)}%</strong> <span class="badge badge-success">Target: 20-40%</span></p>
                            <h4 style="margin-top: 10px;">Caching</h4>
                            <p>Hit Rate: <strong>${caching.hit_rate_percent?.toFixed(1)}%</strong></p>
                            <p>Hits: <strong>${caching.total_hits || 0}</strong> | Misses: <strong>${caching.total_misses || 0}</strong></p>
                            <p>Cache Size: <strong>${caching.cache_size || 0}</strong></p>
                            <h4 style="margin-top: 10px;">Resource Pooling</h4>
                            <p>Thread Workers: <strong>${pooling.thread_workers || 0}</strong></p>
                            <p>Process Workers: <strong>${pooling.process_workers || 0}</strong></p>
                            <h4 style="margin-top: 10px;">Optimized FFT</h4>
                            <p>Real FFT: <span class="badge badge-${fft.real_fft_enabled ? 'success' : 'warning'}">${fft.real_fft_enabled ? 'ON' : 'OFF'}</span></p>
                            <p>Cached Windows: <span class="badge badge-${fft.cached_windows ? 'success' : 'warning'}">${fft.cached_windows ? 'ON' : 'OFF'}</span></p>
                            <p>Avg Time: <strong>${fft.avg_time_ms?.toFixed(2)} ms</strong></p>
                            <p>Operations Monitored: <strong>${data.operations_monitored || 0}</strong></p>
                        `;
                    } else {
                        document.getElementById('performance-stats').innerHTML = `<p><span class="status-indicator status-inactive"></span>Not available</p>`;
                    }
                });
        }
        
        // Update security auditor panel
        function updateSecurityAuditor() {
            fetch('/api/security_audit')
                .then(r => r.json())
                .then(data => {
                    if (data && Object.keys(data).length > 0) {
                        document.getElementById('security-auditor-panel').innerHTML = `
                            <p><span class="status-indicator status-active"></span>Status: <strong>Active</strong></p>
                            <p>Compliance Score: <span class="badge badge-success">${data.compliance_score || 'N/A'}%</span></p>
                            <p>Last Audit: <small>${data.last_audit || 'Never'}</small></p>
                        `;
                    } else {
                        document.getElementById('security-auditor-panel').innerHTML = `<p><span class="status-indicator status-inactive"></span>Loading...</p>`;
                    }
                });
        }
        
        // Update all v1.7.0 panels
        function updateV170Panels() {
            updateEnvironmentalAdaptation();
            updateProfilingMetrics();
            updateE2EValidation();
            updateModelZoo();
            updateErrorRecoveryStatus();
            updateDataValidation();
            updatePerformanceStats();
            updateSecurityAuditor();
        }
        
        // Request data on interval
        setInterval(() => {
            socket.emit('request_data', { type: 'kpis' });
            socket.emit('request_data', { type: 'cellular' });
            socket.emit('request_data', { type: 'health' });
            socket.emit('request_data', { type: 'exploits' });
            socket.emit('request_data', { type: 'analytics' });
            socket.emit('request_data', { type: 'ntn' });
            socket.emit('request_data', { type: 'agents' });
            socket.emit('request_data', { type: 'emissions' });
            socket.emit('request_data', { type: 'sdr' });
            socket.emit('request_data', { type: 'targets' });
            socket.emit('request_data', { type: 'config' });
            socket.emit('request_data', { type: 'regulatory' });
            socket.emit('request_data', { type: 'quick_status' });
            
            // Update v1.7.0 Phase 1 panels
            updateV170Panels();
            
            // Update wizard status if setup tab is active
            const setupTab = document.getElementById('tab-setup');
            if (setupTab && setupTab.classList.contains('active')) {
                updateWizardStatus();
            }
        }, 100);
        
        // ===== SETUP WIZARD FUNCTIONS =====
        
        function checkDependencies() {
            // Show dependencies panel
            const panel = document.getElementById('dependencies-panel');
            if (panel) {
                panel.style.display = 'block';
                panel.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            
            const statusDiv = document.getElementById('dependencies-status');
            statusDiv.innerHTML = '<div style="text-align: center; padding: 30px;"><div class="loading-spinner"></div><p style="margin-top: 15px; color: var(--text-secondary);">Scanning system dependencies...</p></div>';
            
            fetch('/api/check_dependencies')
                .then(response => response.json())
                .then(data => {
                    let html = '<div style="animation: fadeIn 0.4s ease-in;">';
                    
                    // SDR Drivers Section
                    html += '<div style="margin-bottom: 25px; background: var(--bg-dark); padding: 20px; border-radius: 10px; border-left: 4px solid var(--accent-cyan);">';
                    html += '<h3 style="margin: 0 0 15px 0; color: var(--accent-cyan); font-size: 16px;">üì° SDR Hardware Drivers</h3>';
                    html += '<div style="display: grid; gap: 10px;">';
                    for (const [name, info] of Object.entries(data.sdr_drivers || {})) {
                        const icon = info.installed ? '‚úÖ' : '‚ùå';
                        const statusColor = info.installed ? 'var(--success)' : 'var(--danger)';
                        html += `<div style="padding: 12px; background: var(--bg-primary); border-radius: 6px; border-left: 3px solid ${statusColor};">`;
                        html += `<div style="display: flex; justify-content: space-between; align-items: center;">`;
                        html += `<div>`;
                        html += `<strong style="color: var(--text-primary);">${icon} ${name.toUpperCase()}</strong>`;
                        html += `<p style="margin: 5px 0 0 0; font-size: 13px; color: var(--text-secondary);">${info.description}</p>`;
                        html += `</div>`;
                        if (!info.installed) {
                            html += `<button onclick="installDependency('${name}')" class="btn" style="background: var(--success); color: #000; padding: 6px 12px; font-size: 12px; min-width: 80px;">Install</button>`;
                        } else {
                            html += `<span style="color: var(--success); font-weight: 600;">Ready</span>`;
                        }
                        html += `</div></div>`;
                    }
                    html += '</div></div>';
                    
                    // Software Tools Section
                    html += '<div style="margin-bottom: 25px; background: var(--bg-dark); padding: 20px; border-radius: 10px; border-left: 4px solid var(--primary-blue);">';
                    html += '<h3 style="margin: 0 0 15px 0; color: var(--primary-blue); font-size: 16px;">üõ†Ô∏è Software Analysis Tools</h3>';
                    html += '<div style="display: grid; gap: 10px;">';
                    for (const [name, info] of Object.entries(data.software || {})) {
                        const icon = info.installed ? '‚úÖ' : '‚ùå';
                        const statusColor = info.installed ? 'var(--success)' : 'var(--danger)';
                        html += `<div style="padding: 12px; background: var(--bg-primary); border-radius: 6px; border-left: 3px solid ${statusColor};">`;
                        html += `<div style="display: flex; justify-content: space-between; align-items: center;">`;
                        html += `<strong style="color: var(--text-primary);">${icon} ${name}</strong>`;
                        if (!info.installed) {
                            html += `<button onclick="installDependency('${name}')" class="btn" style="background: var(--success); color: #000; padding: 6px 12px; font-size: 12px; min-width: 80px;">Install</button>`;
                        } else {
                            html += `<span style="color: var(--success); font-weight: 600;">Ready</span>`;
                        }
                        html += `</div></div>`;
                    }
                    html += '</div></div>';
                    
                    // Python Packages Section
                    html += '<div style="margin-bottom: 25px; background: var(--bg-dark); padding: 20px; border-radius: 10px; border-left: 4px solid #4CAF50;">';
                    html += '<h3 style="margin: 0 0 15px 0; color: #4CAF50; font-size: 16px;">üêç Python Dependencies</h3>';
                    html += '<div style="display: grid; gap: 10px;">';
                    for (const [name, info] of Object.entries(data.python_packages || {})) {
                        const icon = info.installed ? '‚úÖ' : '‚ùå';
                        const statusColor = info.installed ? 'var(--success)' : 'var(--danger)';
                        html += `<div style="padding: 12px; background: var(--bg-primary); border-radius: 6px; border-left: 3px solid ${statusColor};">`;
                        html += `<div style="display: flex; justify-content: space-between; align-items: center;">`;
                        html += `<strong style="color: var(--text-primary);">${icon} ${name}</strong>`;
                        if (!info.installed) {
                            html += `<button onclick="installDependency('${name}')" class="btn" style="background: var(--success); color: #000; padding: 6px 12px; font-size: 12px; min-width: 80px;">Install</button>`;
                        } else {
                            html += `<span style="color: var(--success); font-weight: 600;">Ready</span>`;
                        }
                        html += `</div></div>`;
                    }
                    html += '</div></div>';
                    
                    // Overall Status Banner
                    const overallIcon = data.overall_status === 'ready' ? '‚úÖ' : (data.overall_status === 'error' ? '‚ùå' : '‚ö†Ô∏è');
                    const bannerColor = data.overall_status === 'ready' ? 'var(--success)' : (data.overall_status === 'error' ? 'var(--danger)' : 'var(--warning)');
                    html += `<div style="padding: 20px; background: rgba(0,229,255,0.1); border: 2px solid ${bannerColor}; border-radius: 10px; text-align: center;">`;
                    html += `<h3 style="margin: 0; font-size: 20px; color: ${bannerColor};">${overallIcon} System Status: ${data.overall_status.toUpperCase()}</h3>`;
                    if (data.error) {
                        html += `<p style="margin: 10px 0 0 0; color: var(--danger);">Error: ${data.error}</p>`;
                    }
                    html += `</div>`;
                    
                    html += '</div>';
                    statusDiv.innerHTML = html;
                })
                .catch(error => {
                    console.error('Error checking dependencies:', error);
                    statusDiv.innerHTML = `
                        <div style="padding: 20px; background: rgba(255,23,68,0.15); border-left: 4px solid var(--danger); border-radius: 10px;">
                            <h3 style="color: var(--danger); margin: 0 0 15px 0;">‚ùå Connection Error</h3>
                            <p style="margin: 0 0 15px 0; color: var(--text-secondary);">Unable to scan system dependencies.</p>
                            
                            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin: 15px 0;">
                                <p style="margin: 0 0 10px 0; font-weight: 600; color: var(--text-primary);">Possible causes:</p>
                                <ul style="margin: 0 0 0 20px; padding: 0; line-height: 1.8; color: var(--text-secondary); font-size: 14px;">
                                    <li>Dashboard server not running properly</li>
                                    <li>API endpoint /api/check_dependencies not implemented</li>
                                    <li>Network connection issue between browser and server</li>
                                    <li>Insufficient permissions to check system packages</li>
                                </ul>
                            </div>
                            
                            <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                                <button onclick="checkDependencies()" class="btn" style="background: var(--accent-cyan); color: #000; flex: 1; min-width: 150px;">üîÑ Retry Scan</button>
                                <button onclick="refreshDeviceStatus()" class="btn" style="background: var(--primary-blue); flex: 1; min-width: 150px;">üîç Check Devices Only</button>
                            </div>
                            
                            <div style="margin-top: 15px; padding: 12px; background: rgba(255,152,0,0.15); border-radius: 6px; font-size: 13px; color: var(--text-secondary);">
                                <strong style="color: var(--warning);">üí° Tip:</strong> You can still install drivers manually using the "Install Drivers" action above.
                            </div>
                        </div>`;
                });
        }
        
        function installDependency(depName) {
            fetch('/api/install_dependency', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name: depName })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const modal = `
                            <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000; animation: fadeIn 0.2s ease-in;" onclick="this.remove()">
                                <div style="background: var(--bg-primary); padding: 30px; border-radius: 15px; max-width: 600px; border: 2px solid var(--accent-cyan); box-shadow: 0 10px 40px rgba(0,0,0,0.5);" onclick="event.stopPropagation()">
                                    <h3 style="margin: 0 0 15px 0; color: var(--accent-cyan); font-size: 18px;">üì¶ Installation Command for ${depName}</h3>
                                    <p style="margin-bottom: 15px; color: var(--text-secondary);">Copy and run the following command in your system terminal with appropriate privileges:</p>
                                    <div style="background: #000; padding: 15px; border-radius: 8px; margin-bottom: 20px; position: relative;">
                                        <code style="color: var(--accent-cyan); font-size: 14px; word-break: break-all;">${data.command}</code>
                                    </div>
                                    <div style="text-align: right;">
                                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="btn" style="background: var(--primary-blue);">Got it!</button>
                                    </div>
                                </div>
                            </div>`;
                        document.body.insertAdjacentHTML('beforeend', modal);
                    } else {
                        alert(`Error: ${data.message}`);
                    }
                })
                .catch(error => {
                    console.error('Error installing dependency:', error);
                    alert('Error installing dependency. Please try again.');
                });
        }
        
        function testDevice(deviceType) {
            const statusDiv = document.getElementById(`${deviceType}-status`);
            statusDiv.innerHTML = '<div style="text-align: center; padding: 20px;"><div class="loading-spinner" style="width: 30px; height: 30px; border-width: 3px;"></div><p style="margin-top: 10px; color: var(--text-secondary);">Testing device connection...</p></div>';
            
            fetch('/api/device_wizard_status')
                .then(response => response.json())
                .then(data => {
                    const deviceInfo = data.devices[deviceType];
                    if (deviceInfo) {
                        const icon = deviceInfo.connected ? '‚úÖ' : '‚ùå';
                        const statusColor = deviceInfo.connected ? 'var(--success)' : 'var(--danger)';
                        const statusText = deviceInfo.connected ? 'Connected & Ready' : 'Not Connected';
                        
                        let html = '<div style="animation: fadeIn 0.4s ease-in;">';
                        html += `<div style="padding: 15px; background: ${deviceInfo.connected ? 'rgba(76,175,80,0.15)' : 'rgba(255,23,68,0.15)'}; border-left: 4px solid ${statusColor}; border-radius: 8px;">`;
                        html += `<div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">`;
                        html += `<strong style="font-size: 16px; color: ${statusColor};">${icon} ${statusText}</strong>`;
                        html += `</div>`;
                        html += `<p style="margin: 0; color: var(--text-secondary); font-size: 13px; line-height: 1.6;">${deviceInfo.info}</p>`;
                        html += `</div></div>`;
                        
                        statusDiv.innerHTML = html;
                    } else {
                        statusDiv.innerHTML = `
                            <div style="padding: 15px; background: rgba(255,23,68,0.15); border-left: 4px solid var(--danger); border-radius: 8px;">
                                <strong style="color: var(--danger);">‚ùå Error</strong>
                                <p style="margin: 5px 0 0 0; color: var(--text-secondary); font-size: 13px;">Unable to check device status. Please verify device connection and try again.</p>
                            </div>`;
                    }
                })
                .catch(error => {
                    console.error('Error testing device:', error);
                    statusDiv.innerHTML = `
                        <div style="padding: 15px; background: rgba(255,23,68,0.15); border-left: 4px solid var(--danger); border-radius: 8px;">
                            <strong style="color: var(--danger);">‚ùå Connection Error</strong>
                            <p style="margin: 5px 0 0 0; color: var(--text-secondary); font-size: 13px;">Failed to communicate with server. Please check your connection and try again.</p>
                        </div>`;
                });
        }
        
        function updateWizardStatus() {
            fetch('/api/device_wizard_status')
                .then(response => response.json())
                .then(data => {
                    // Update device status displays if they exist
                    for (const [deviceType, deviceInfo] of Object.entries(data.devices || {})) {
                        const statusDiv = document.getElementById(`${deviceType}-status`);
                        if (statusDiv && statusDiv.innerHTML !== '' && !statusDiv.innerHTML.includes('loading-spinner')) {
                            const icon = deviceInfo.connected ? '‚úÖ' : '‚ùå';
                            const statusColor = deviceInfo.connected ? 'var(--success)' : 'var(--danger)';
                            const statusText = deviceInfo.connected ? 'Connected & Ready' : 'Not Connected';
                            
                            let html = `<div style="padding: 15px; background: ${deviceInfo.connected ? 'rgba(76,175,80,0.15)' : 'rgba(255,23,68,0.15)'}; border-left: 4px solid ${statusColor}; border-radius: 8px;">`;
                            html += `<div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">`;
                            html += `<strong style="font-size: 16px; color: ${statusColor};">${icon} ${statusText}</strong>`;
                            html += `</div>`;
                            html += `<p style="margin: 0; color: var(--text-secondary); font-size: 13px; line-height: 1.6;">${deviceInfo.info.substring(0, 150)}${deviceInfo.info.length > 150 ? '...' : ''}</p>`;
                            html += `</div>`;
                            statusDiv.innerHTML = html;
                        }
                    }
                })
                .catch(error => {
                    console.error('Error updating wizard status:', error);
                });
        }
        
        // New Setup Wizard Functions
        function refreshDeviceStatus() {
            const overview = document.getElementById('connected-devices-overview');
            overview.innerHTML = '<div class="loading-spinner" style="width: 40px; height: 40px; margin: 20px auto;"></div><p style="text-align: center; color: var(--text-secondary);">Scanning for devices...</p>';
            
            fetch('/api/device_wizard_status')
                .then(response => response.json())
                .then(data => {
                    let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; margin-top: 15px;">';
                    
                    const devices = data.devices || {};
                    const deviceTypes = ['usrp', 'hackrf', 'bladerf', 'limesdr'];
                    
                    deviceTypes.forEach(type => {
                        const deviceInfo = devices[type] || { connected: false, info: 'No device detected' };
                        const icon = deviceInfo.connected ? '‚úÖ' : '‚ùå';
                        const color = deviceInfo.connected ? 'var(--success)' : 'var(--text-secondary)';
                        const bgColor = deviceInfo.connected ? 'rgba(76,175,80,0.1)' : 'rgba(150,150,150,0.05)';
                        
                        html += `
                            <div class="device-card" style="background: ${bgColor}; border: 1px solid var(--border-color); border-left: 4px solid ${color}; border-radius: 10px; padding: 20px; transition: all 0.3s ease;">
                                <div style="font-size: 32px; text-align: center; margin-bottom: 10px;">${icon}</div>
                                <h3 style="color: ${color}; text-align: center; margin: 10px 0; text-transform: uppercase; font-size: 18px;">${type}</h3>
                                <p style="color: var(--text-secondary); font-size: 13px; text-align: center; min-height: 40px;">${deviceInfo.info.substring(0, 100)}${deviceInfo.info.length > 100 ? '...' : ''}</p>
                                <button onclick="testDevice('${type}')" class="btn" style="width: 100%; margin-top: 10px; background: var(--accent-cyan); color: #000; font-weight: 600;">üß™ Test Device</button>
                            </div>`;
                    });
                    
                    html += '</div>';
                    
                    if (Object.values(devices).every(d => !d.connected)) {
                        html += `
                            <div style="margin-top: 20px; padding: 20px; background: rgba(255,152,0,0.1); border-left: 4px solid var(--warning); border-radius: 8px;">
                                <strong style="color: var(--warning);">‚ö†Ô∏è No SDR Devices Detected</strong>
                                <p style="margin: 10px 0 0 0; color: var(--text-secondary); font-size: 14px;">Please ensure your SDR device is connected via USB and drivers are installed. Click "Install Drivers" below to begin setup.</p>
                            </div>`;
                    }
                    
                    overview.innerHTML = html;
                })
                .catch(error => {
                    console.error('Error refreshing device status:', error);
                    overview.innerHTML = `
                        <div style="padding: 20px; background: rgba(255,23,68,0.15); border-left: 4px solid var(--danger); border-radius: 10px;">
                            <h3 style="color: var(--danger);">‚ùå Connection Error</h3>
                            <p style="color: var(--text-secondary); margin: 10px 0;">Unable to scan for devices.</p>
                            <p style="margin-top: 15px; font-size: 14px;"><strong>Possible causes:</strong></p>
                            <ul style="margin: 10px 0 10px 20px; line-height: 1.8; color: var(--text-secondary); font-size: 13px;">
                                <li>Dashboard server not running properly</li>
                                <li>API endpoint /api/device_wizard_status not responding</li>
                                <li>USB permissions issue (try running with sudo)</li>
                            </ul>
                            <button onclick="refreshDeviceStatus()" class="btn" style="background: var(--accent-cyan); color: #000; margin-top: 15px;">üîÑ Retry Scan</button>
                        </div>`;
                });
        }
        
        function showInstallSection() {
            hideAllWizardSections();
            const actionSections = document.getElementById('action-sections');
            actionSections.innerHTML = `
                <div class="panel panel-large" style="animation: slideIn 0.3s ease-out;">
                    <h2>üì• Install SDR Drivers</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Select your SDR device to view installation instructions:</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px;">
                        <button onclick="showDeviceInstall('usrp')" class="btn" style="background: var(--accent-cyan); color: #000; padding: 15px; font-size: 16px;">üì° USRP</button>
                        <button onclick="showDeviceInstall('hackrf')" class="btn" style="background: var(--accent-cyan); color: #000; padding: 15px; font-size: 16px;">üìª HackRF</button>
                        <button onclick="showDeviceInstall('bladerf')" class="btn" style="background: var(--accent-cyan); color: #000; padding: 15px; font-size: 16px;">üìü bladeRF</button>
                        <button onclick="showDeviceInstall('limesdr')" class="btn" style="background: var(--accent-cyan); color: #000; padding: 15px; font-size: 16px;">üì± LimeSDR</button>
                    </div>
                    
                    <div id="device-install-content" style="margin-top: 20px;"></div>
                    
                    <div style="margin-top: 20px; padding: 16px; background: rgba(255,152,0,0.15); border-left: 4px solid var(--warning); border-radius: 8px;">
                        <strong style="color: var(--warning);">‚ö†Ô∏è Important:</strong>
                        <ul style="margin: 10px 0 0 20px; line-height: 1.8; color: var(--text-secondary);">
                            <li>Run all commands in your system terminal with sudo privileges</li>
                            <li>Ensure device is connected via USB before installation</li>
                            <li>Reboot may be required after driver installation</li>
                        </ul>
                    </div>
                </div>`;
        }
        
        function showDeviceInstall(device) {
            const content = document.getElementById('device-install-content');
            const installations = {
                'usrp': {
                    name: 'USRP (Universal Software Radio Peripheral)',
                    steps: [
                        { title: 'Install UHD Driver', command: 'sudo apt-get install libuhd-dev uhd-host' },
                        { title: 'Download FPGA Images', command: 'sudo uhd_images_downloader' },
                        { title: 'Set USB Permissions', command: 'sudo usermod -aG usrp $USER' }
                    ]
                },
                'hackrf': {
                    name: 'HackRF One',
                    steps: [
                        { title: 'Install HackRF Driver', command: 'sudo apt-get install hackrf libhackrf-dev' },
                        { title: 'Update Firmware', command: 'hackrf_spiflash -w /usr/share/hackrf/hackrf_one_usb.bin' },
                        { title: 'Set udev Rules', command: 'sudo cp /usr/share/hackrf/53-hackrf.rules /etc/udev/rules.d/' }
                    ]
                },
                'bladerf': {
                    name: 'bladeRF',
                    steps: [
                        { title: 'Install bladeRF Driver', command: 'sudo apt-get install bladerf libbladerf-dev' },
                        { title: 'Load FPGA Image', command: 'bladeRF-cli -l /usr/share/Nuand/bladeRF/hostedxA4.rbf' },
                        { title: 'Update Firmware', command: 'bladeRF-cli -f /usr/share/Nuand/bladeRF/bladeRF_fw.img' }
                    ]
                },
                'limesdr': {
                    name: 'LimeSDR',
                    steps: [
                        { title: 'Install LimeSuite', command: 'sudo apt-get install limesuite liblimesuite-dev' },
                        { title: 'Update Firmware', command: 'LimeUtil --update' },
                        { title: 'Install udev Rules', command: 'sudo cp /usr/local/lib/udev/rules.d/64-limesuite.rules /etc/udev/rules.d/' }
                    ]
                }
            };
            
            const install = installations[device];
            let html = `<div style="background: var(--bg-dark); padding: 20px; border-radius: 10px; border: 1px solid var(--border-color);">`;
            html += `<h3 style="color: var(--accent-cyan); margin-bottom: 20px;">üì¶ ${install.name} Installation</h3>`;
            
            install.steps.forEach((step, index) => {
                html += `
                    <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <p style="font-weight: 600; color: var(--text-primary); margin-bottom: 10px;">üî∏ Step ${index + 1}: ${step.title}</p>
                        <div style="position: relative;">
                            <code style="display: block; background: #000; padding: 12px; border-radius: 6px; color: var(--accent-cyan); font-size: 13px; font-family: 'Courier New', monospace;">${step.command}</code>
                            <button onclick="copyToClipboard('${step.command.replace(/'/g, "\'")}')" class="btn" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); padding: 5px 10px; font-size: 11px;">üìã Copy</button>
                        </div>
                    </div>`;
            });
            
            html += `<button onclick="testDevice('${device}')" class="btn" style="width: 100%; background: var(--success); color: #000; font-weight: 600; margin-top: 10px;">‚úÖ Test ${device.toUpperCase()} Connection</button>`;
            html += `</div>`;
            
            content.innerHTML = html;
        }
        
        function showVerifySection() {
            hideAllWizardSections();
            const actionSections = document.getElementById('action-sections');
            actionSections.innerHTML = `
                <div class="panel panel-large" style="animation: slideIn 0.3s ease-out;">
                    <h2>‚úÖ Verify Device Connection</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Test all connected SDR devices to verify they are working correctly:</p>
                    
                    <div id="verify-results" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-top: 20px;">
                        <div class="loading-spinner" style="width: 40px; height: 40px; margin: 20px auto;"></div>
                        <p style="text-align: center; color: var(--text-secondary);">Running device tests...</p>
                    </div>
                    
                    <button onclick="runAllDeviceTests()" class="btn" style="width: 100%; background: var(--accent-cyan); color: #000; margin-top: 20px; padding: 15px; font-size: 16px;">üîÑ Re-run All Tests</button>
                </div>`;
            
            setTimeout(() => runAllDeviceTests(), 500);
        }
        
        function runAllDeviceTests() {
            const results = document.getElementById('verify-results');
            results.innerHTML = '<div class="loading-spinner" style="width: 40px; height: 40px; margin: 20px auto;"></div><p style="text-align: center; color: var(--text-secondary);">Testing devices...</p>';
            
            fetch('/api/device_wizard_status')
                .then(response => response.json())
                .then(data => {
                    const devices = data.devices || {};
                    let html = '';
                    
                    Object.entries(devices).forEach(([type, info]) => {
                        const icon = info.connected ? '‚úÖ' : '‚ùå';
                        const color = info.connected ? 'var(--success)' : 'var(--danger)';
                        const bgColor = info.connected ? 'rgba(76,175,80,0.1)' : 'rgba(255,23,68,0.1)';
                        
                        html += `
                            <div style="background: ${bgColor}; border: 1px solid var(--border-color); border-left: 4px solid ${color}; border-radius: 10px; padding: 20px;">
                                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                                    <h3 style="color: ${color}; margin: 0; text-transform: uppercase;">${type}</h3>
                                    <div style="font-size: 28px;">${icon}</div>
                                </div>
                                <p style="color: var(--text-secondary); font-size: 13px; line-height: 1.6; min-height: 60px;">${info.info}</p>
                                ${!info.connected ? `<button onclick="showFixSection()" class="btn" style="width: 100%; background: var(--warning); color: #000; margin-top: 10px;">üîß Troubleshoot</button>` : ''}
                            </div>`;
                    });
                    
                    results.innerHTML = html;
                })
                .catch(error => {
                    results.innerHTML = `<div style="padding: 20px; background: rgba(255,23,68,0.15); border-radius: 10px; text-align: center;">
                        <p style="color: var(--danger);">‚ùå Failed to test devices</p>
                        <button onclick="runAllDeviceTests()" class="btn" style="margin-top: 15px;">üîÑ Retry</button>
                    </div>`;
                });
        }
        
        function showFixSection() {
            hideAllWizardSections();
            const actionSections = document.getElementById('action-sections');
            actionSections.innerHTML = `
                <div class="panel panel-large" style="animation: slideIn 0.3s ease-out;">
                    <h2>üîß Troubleshoot Device Issues</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Common solutions for SDR device connectivity problems:</p>
                    
                    <div style="display: grid; gap: 15px;">
                        <div class="fix-card" style="background: var(--bg-dark); padding: 20px; border-radius: 10px; border-left: 4px solid var(--accent-cyan);">
                            <h3 style="color: var(--accent-cyan); margin-bottom: 10px;">üîå Check USB Connection</h3>
                            <p style="color: var(--text-secondary); font-size: 14px; line-height: 1.6;">
                                ‚Ä¢ Ensure device is securely connected to USB port<br>
                                ‚Ä¢ Try a different USB port (prefer USB 3.0)<br>
                                ‚Ä¢ Use a high-quality USB cable<br>
                                ‚Ä¢ Avoid USB hubs when possible
                            </p>
                            <code style="display: block; background: #000; padding: 10px; border-radius: 6px; color: var(--accent-cyan); margin-top: 10px;">lsusb  # List all USB devices</code>
                        </div>
                        
                        <div class="fix-card" style="background: var(--bg-dark); padding: 20px; border-radius: 10px; border-left: 4px solid var(--warning);">
                            <h3 style="color: var(--warning); margin-bottom: 10px;">üîë Fix USB Permissions</h3>
                            <p style="color: var(--text-secondary); font-size: 14px; line-height: 1.6;">
                                Many SDR devices require specific udev rules for non-root access:
                            </p>
                            <code style="display: block; background: #000; padding: 10px; border-radius: 6px; color: var(--accent-cyan); margin-top: 10px;">sudo usermod -aG plugdev $USER<br>sudo udevadm control --reload-rules</code>
                            <p style="color: var(--text-secondary); font-size: 13px; margin-top: 10px;">‚ö†Ô∏è Log out and back in after running these commands</p>
                        </div>
                        
                        <div class="fix-card" style="background: var(--bg-dark); padding: 20px; border-radius: 10px; border-left: 4px solid var(--success);">
                            <h3 style="color: var(--success); margin-bottom: 10px;">üîÑ Reinstall Drivers</h3>
                            <p style="color: var(--text-secondary); font-size: 14px; line-height: 1.6;">
                                If device still not detected, try reinstalling drivers:
                            </p>
                            <button onclick="showInstallSection()" class="btn" style="background: var(--success); color: #000; margin-top: 10px;">üì• Go to Installation</button>
                        </div>
                        
                        <div class="fix-card" style="background: var(--bg-dark); padding: 20px; border-radius: 10px; border-left: 4px solid var(--danger);">
                            <h3 style="color: var(--danger); margin-bottom: 10px;">‚ö° Check Power Supply</h3>
                            <p style="color: var(--text-secondary); font-size: 14px; line-height: 1.6;">
                                ‚Ä¢ Some devices require external power<br>
                                ‚Ä¢ USB port may not provide enough current<br>
                                ‚Ä¢ Try a powered USB hub<br>
                                ‚Ä¢ Check device LED indicators
                            </p>
                        </div>
                    </div>
                    
                    <button onclick="refreshDeviceStatus()" class="btn" style="width: 100%; background: var(--accent-cyan); color: #000; margin-top: 20px; padding: 15px; font-size: 16px;">üîÑ Re-scan Devices</button>
                </div>`;
        }
        
        function showUninstallSection() {
            hideAllWizardSections();
            const actionSections = document.getElementById('action-sections');
            actionSections.innerHTML = `
                <div class="panel panel-large" style="animation: slideIn 0.3s ease-out;">
                    <h2>üóëÔ∏è Uninstall SDR Drivers</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Remove SDR drivers and dependencies from your system:</p>
                    
                    <div style="padding: 20px; background: rgba(255,23,68,0.15); border-left: 4px solid var(--danger); border-radius: 10px; margin-bottom: 20px;">
                        <strong style="color: var(--danger);">‚ö†Ô∏è Warning:</strong>
                        <p style="color: var(--text-secondary); margin-top: 10px;">This will remove all SDR drivers. You will need to reinstall them to use your devices again.</p>
                    </div>
                    
                    <div style="display: grid; gap: 15px;">
                        <div style="background: var(--bg-dark); padding: 20px; border-radius: 10px;">
                            <h3 style="color: var(--text-primary); margin-bottom: 15px;">üì° USRP</h3>
                            <code style="display: block; background: #000; padding: 12px; border-radius: 6px; color: var(--accent-cyan); font-size: 13px;">sudo apt-get remove --purge libuhd-dev uhd-host</code>
                        </div>
                        
                        <div style="background: var(--bg-dark); padding: 20px; border-radius: 10px;">
                            <h3 style="color: var(--text-primary); margin-bottom: 15px;">üìª HackRF</h3>
                            <code style="display: block; background: #000; padding: 12px; border-radius: 6px; color: var(--accent-cyan); font-size: 13px;">sudo apt-get remove --purge hackrf libhackrf-dev</code>
                        </div>
                        
                        <div style="background: var(--bg-dark); padding: 20px; border-radius: 10px;">
                            <h3 style="color: var(--text-primary); margin-bottom: 15px;">üìü bladeRF</h3>
                            <code style="display: block; background: #000; padding: 12px; border-radius: 6px; color: var(--accent-cyan); font-size: 13px;">sudo apt-get remove --purge bladerf libbladerf-dev</code>
                        </div>
                        
                        <div style="background: var(--bg-dark); padding: 20px; border-radius: 10px;">
                            <h3 style="color: var(--text-primary); margin-bottom: 15px;">üì± LimeSDR</h3>
                            <code style="display: block; background: #000; padding: 12px; border-radius: 6px; color: var(--accent-cyan); font-size: 13px;">sudo apt-get remove --purge limesuite liblimesuite-dev</code>
                        </div>
                    </div>
                    
                    <div style="background: var(--bg-dark); padding: 20px; border-radius: 10px; margin-top: 20px;">
                        <h3 style="color: var(--text-primary); margin-bottom: 15px;">üßπ Clean up unused dependencies</h3>
                        <code style="display: block; background: #000; padding: 12px; border-radius: 6px; color: var(--accent-cyan); font-size: 13px;">sudo apt-get autoremove<br>sudo apt-get autoclean</code>
                    </div>
                </div>`;
        }
        
        function showResetSection() {
            hideAllWizardSections();
            const actionSections = document.getElementById('action-sections');
            actionSections.innerHTML = `
                <div class="panel panel-large" style="animation: slideIn 0.3s ease-out;">
                    <h2>üîÑ Reset Device Configuration</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Reset SDR devices to factory defaults:</p>
                    
                    <div style="display: grid; gap: 15px;">
                        <div style="background: var(--bg-dark); padding: 20px; border-radius: 10px; border-left: 4px solid var(--accent-cyan);">
                            <h3 style="color: var(--accent-cyan); margin-bottom: 15px;">üì° USRP - Reset to Defaults</h3>
                            <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 10px;">Clear stored settings and reload FPGA:</p>
                            <code style="display: block; background: #000; padding: 12px; border-radius: 6px; color: var(--accent-cyan); font-size: 13px;">uhd_usrp_probe --args="type=b200"<br>sudo uhd_images_downloader</code>
                        </div>
                        
                        <div style="background: var(--bg-dark); padding: 20px; border-radius: 10px; border-left: 4px solid var(--warning);">
                            <h3 style="color: var(--warning); margin-bottom: 15px;">üìª HackRF - Reflash Firmware</h3>
                            <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 10px;">Restore factory firmware:</p>
                            <code style="display: block; background: #000; padding: 12px; border-radius: 6px; color: var(--accent-cyan); font-size: 13px;">hackrf_spiflash -w /usr/share/hackrf/hackrf_one_usb.bin<br>hackrf_cpldjtag -x /usr/share/hackrf/hackrf_cpld_default.xsvf</code>
                        </div>
                        
                        <div style="background: var(--bg-dark); padding: 20px; border-radius: 10px; border-left: 4px solid var(--success);">
                            <h3 style="color: var(--success); margin-bottom: 15px;">üìü bladeRF - Restore Defaults</h3>
                            <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 10px;">Reload FPGA and firmware:</p>
                            <code style="display: block; background: #000; padding: 12px; border-radius: 6px; color: var(--accent-cyan); font-size: 13px;">bladeRF-cli -l /usr/share/Nuand/bladeRF/hostedxA4.rbf<br>bladeRF-cli -f /usr/share/Nuand/bladeRF/bladeRF_fw.img</code>
                        </div>
                        
                        <div style="background: var(--bg-dark); padding: 20px; border-radius: 10px; border-left: 4px solid var(--danger);">
                            <h3 style="color: var(--danger); margin-bottom: 15px;">üì± LimeSDR - Factory Reset</h3>
                            <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 10px;">Update firmware and gateware:</p>
                            <code style="display: block; background: #000; padding: 12px; border-radius: 6px; color: var(--accent-cyan); font-size: 13px;">LimeUtil --update<br>LimeUtil --make</code>
                        </div>
                    </div>
                    
                    <div style="padding: 20px; background: rgba(255,152,0,0.15); border-left: 4px solid var(--warning); border-radius: 10px; margin-top: 20px;">
                        <strong style="color: var(--warning);">‚ö†Ô∏è Note:</strong>
                        <p style="color: var(--text-secondary); margin-top: 10px;">After resetting, you may need to power cycle (unplug and replug) your device.</p>
                    </div>
                    
                    <button onclick="refreshDeviceStatus()" class="btn" style="width: 100%; background: var(--accent-cyan); color: #000; margin-top: 20px; padding: 15px; font-size: 16px;">üîÑ Check Device Status</button>
                </div>`;
        }
        
        function hideAllWizardSections() {
            const actionSections = document.getElementById('action-sections');
            if (actionSections) {
                actionSections.innerHTML = '';
            }
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Show temporary success message
                const notification = document.createElement('div');
                notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: var(--success); color: #000; padding: 15px 20px; border-radius: 8px; font-weight: 600; z-index: 10000; animation: slideIn 0.3s ease-out;';
                notification.textContent = '‚úÖ Copied to clipboard!';
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        }
        
        // ==================== SYSTEM TOOLS MANAGEMENT FUNCTIONS ====================
        
        function loadSystemToolsStatus() {
            const grid = document.getElementById('system-tools-grid');
            grid.innerHTML = '<div style="text-align: center; padding: 40px; grid-column: 1 / -1; color: var(--text-secondary);"><div class="loading-spinner" style="margin: 0 auto 15px;"></div><p>Loading system tools status...</p></div>';
            
            fetch('/api/system_tools/status')
                .then(response => response.json())
                .then(data => {
                    // Update summary stats
                    document.getElementById('tools-installed-count').textContent = data.installed || 0;
                    document.getElementById('tools-missing-count').textContent = data.missing || 0;
                    document.getElementById('tools-completion-percent').textContent = (data.completion_percent || 0) + '%';
                    
                    // Build tools grid
                    let html = '';
                    
                    // Group tools by category
                    const categories = {};
                    for (const [toolId, toolInfo] of Object.entries(data.tools || {})) {
                        const cat = toolInfo.category || 'Other';
                        if (!categories[cat]) categories[cat] = [];
                        categories[cat].push({ id: toolId, ...toolInfo });
                    }
                    
                    // Render each category
                    for (const [category, tools] of Object.entries(categories)) {
                        tools.forEach(tool => {
                            const statusColor = tool.installed ? 'var(--success)' : 'var(--danger)';
                            const statusBg = tool.installed ? 'rgba(76,175,80,0.1)' : 'rgba(255,23,68,0.1)';
                            const statusIcon = tool.installed ? '‚úÖ' : '‚ùå';
                            const statusText = tool.installed ? 'Installed' : 'Not Installed';
                            
                            html += `
                                <div class="tool-card" style="background: var(--bg-dark); border: 2px solid ${statusColor}; border-radius: 12px; padding: 20px; transition: all 0.3s ease; position: relative;">
                                    <div style="position: absolute; top: 10px; right: 10px; background: ${statusBg}; color: ${statusColor}; padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: bold;">
                                        ${statusIcon} ${statusText}
                                    </div>
                                    
                                    <div style="font-size: 40px; text-align: center; margin-bottom: 10px;">${tool.icon || 'üîß'}</div>
                                    
                                    <h3 style="margin: 0 0 8px 0; font-size: 16px; text-align: center; color: var(--text-primary);">${tool.name}</h3>
                                    
                                    <div style="text-align: center; margin-bottom: 12px;">
                                        <span style="background: rgba(0,229,255,0.15); color: var(--accent-cyan); padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600;">
                                            ${tool.category}
                                        </span>
                                    </div>
                                    
                                    <p style="margin: 0 0 15px 0; font-size: 13px; color: var(--text-secondary); text-align: center; min-height: 40px;">
                                        ${tool.description}
                                    </p>
                                    
                                    ${tool.version ? `<div style="text-align: center; margin-bottom: 12px; font-size: 12px; color: var(--text-secondary);">Version: <span style="color: var(--success); font-weight: 600;">${tool.version}</span></div>` : ''}
                                    
                                    <div style="display: grid; gap: 8px;">
                                        ${!tool.installed ? `
                                            <button onclick="installSystemTool('${tool.id}')" class="btn" style="width: 100%; background: var(--success); color: #000; font-weight: 600; padding: 10px;">
                                                üì• Install
                                            </button>
                                        ` : `
                                            <button onclick="testSystemTool('${tool.id}')" class="btn" style="width: 100%; background: var(--primary-blue); padding: 10px;">
                                                üß™ Test
                                            </button>
                                            <button onclick="uninstallSystemTool('${tool.id}')" class="btn" style="width: 100%; background: var(--danger); padding: 10px;">
                                                üóëÔ∏è Uninstall
                                            </button>
                                        `}
                                        <button onclick="showToolDetails('${tool.id}')" class="btn" style="width: 100%; background: var(--bg-darker); border: 1px solid var(--border-color); padding: 10px;">
                                            ‚ÑπÔ∏è Details
                                        </button>
                                    </div>
                                </div>
                            `;
                        });
                    }
                    
                    if (html === '') {
                        html = '<div style="text-align: center; padding: 40px; grid-column: 1 / -1; color: var(--text-secondary);"><p>No system tools configured</p></div>';
                    }
                    
                    grid.innerHTML = html;
                })
                .catch(error => {
                    console.error('Error loading system tools:', error);
                    grid.innerHTML = `
                        <div style="padding: 20px; background: rgba(255,23,68,0.15); border-left: 4px solid var(--danger); border-radius: 10px; grid-column: 1 / -1;">
                            <h3 style="color: var(--danger); margin: 0 0 10px 0;">‚ùå Connection Error</h3>
                            <p style="margin: 0; color: var(--text-secondary);">Unable to load system tools status.</p>
                            <button onclick="loadSystemToolsStatus()" class="btn" style="background: var(--accent-cyan); color: #000; margin-top: 15px;">üîÑ Retry</button>
                        </div>
                    `;
                });
        }
        
        function installSystemTool(toolName) {
            fetch('/api/system_tools/install', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ tool: toolName })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Show installation instructions
                    showToolDetails(toolName, data);
                } else {
                    showNotification('‚ùå ' + (data.message || 'Installation failed'), 'error');
                }
            })
            .catch(error => {
                console.error('Error installing tool:', error);
                showNotification('‚ùå Installation error: ' + error.message, 'error');
            });
        }
        
        function uninstallSystemTool(toolName) {
            if (!confirm(`Are you sure you want to uninstall ${toolName}?`)) {
                return;
            }
            
            fetch('/api/system_tools/uninstall', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ tool: toolName })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToolDetails(toolName, data);
                } else {
                    showNotification('‚ùå ' + (data.message || 'Uninstallation failed'), 'error');
                }
            })
            .catch(error => {
                console.error('Error uninstalling tool:', error);
                showNotification('‚ùå Uninstallation error: ' + error.message, 'error');
            });
        }
        
        function testSystemTool(toolName) {
            showNotification('üß™ Testing ' + toolName + '...', 'info');
            
            fetch('/api/system_tools/test', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ tool: toolName })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.working) {
                    showNotification('‚úÖ ' + toolName + ' is working correctly', 'success');
                } else if (data.success) {
                    showNotification('‚ö†Ô∏è ' + (data.message || toolName + ' test completed with warnings'), 'warning');
                } else {
                    showNotification('‚ùå ' + (data.message || 'Test failed'), 'error');
                }
                
                // Show detailed output
                if (data.output) {
                    showToolDetails(toolName, data);
                }
            })
            .catch(error => {
                console.error('Error testing tool:', error);
                showNotification('‚ùå Test error: ' + error.message, 'error');
            });
        }
        
        function showToolDetails(toolName, data = null) {
            const modal = document.getElementById('tool-details-modal');
            const content = document.getElementById('tool-details-content');
            
            let html = `<h2 style="margin: 0 0 20px 0;">üõ†Ô∏è ${toolName}</h2>`;
            
            if (data) {
                if (data.instructions) {
                    html += `
                        <div style="background: var(--bg-dark); padding: 20px; border-radius: 10px; border-left: 4px solid var(--warning); margin-bottom: 20px;">
                            <h3 style="margin: 0 0 15px 0; color: var(--warning);">‚ö†Ô∏è Installation Instructions</h3>
                            <pre style="background: var(--bg-primary); padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 13px; line-height: 1.6;">${data.command}</pre>
                            <p style="margin: 15px 0 0 0; color: var(--text-secondary); font-size: 14px;">
                                Please run the above command in your terminal with sudo privileges.
                            </p>
                            <button onclick="copyToClipboard(data.command)" class="btn" style="background: var(--accent-cyan); color: #000; margin-top: 15px;">
                                üìã Copy Command
                            </button>
                        </div>
                    `;
                }
                
                if (data.output) {
                    html += `
                        <div style="background: var(--bg-dark); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h3 style="margin: 0 0 15px 0;">üìÑ Test Output</h3>
                            <pre style="background: var(--bg-primary); padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 12px; line-height: 1.6; max-height: 300px;">${data.output}</pre>
                        </div>
                    `;
                }
                
                if (data.message) {
                    html += `
                        <div style="padding: 15px; background: rgba(0,229,255,0.1); border-radius: 8px; border-left: 4px solid var(--accent-cyan);">
                            <p style="margin: 0; color: var(--text-secondary);">${data.message}</p>
                        </div>
                    `;
                }
            } else {
                html += `
                    <div style="text-align: center; padding: 30px;">
                        <div class="loading-spinner" style="margin: 0 auto 15px;"></div>
                        <p style="color: var(--text-secondary);">Loading tool details...</p>
                    </div>
                `;
            }
            
            content.innerHTML = html;
            modal.style.display = 'block';
        }
        
        function closeToolDetails() {
            const modal = document.getElementById('tool-details-modal');
            modal.style.display = 'none';
        }
        
        function showNotification(message, type = 'info') {
            const colors = {
                'success': 'var(--success)',
                'error': 'var(--danger)',
                'warning': 'var(--warning)',
                'info': 'var(--primary-blue)'
            };
            
            const notification = document.createElement('div');
            notification.style.cssText = `position: fixed; top: 20px; right: 20px; background: ${colors[type] || colors.info}; color: ${type === 'success' ? '#000' : '#fff'}; padding: 15px 20px; border-radius: 8px; font-weight: 600; z-index: 10000; animation: slideIn 0.3s ease-out; max-width: 400px;`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 4000);
        }
        
        // Auto-load system tools when Tools tab is opened
        const originalShowTab2 = showTab;
        showTab = function(tabName) {
            if (typeof originalShowTab2 === 'function') {
                originalShowTab2(tabName);
            }
            if (tabName === 'tools') {
                setTimeout(() => loadSystemToolsStatus(), 300);
            }
            if (tabName === 'setup') {
                setTimeout(() => refreshDeviceStatus(), 300);
            }
        };
        
        // Auto-refresh device status when Setup tab is opened
        const originalShowTab = showTab;
        showTab = function(tabName) {
            originalShowTab(tabName);
            if (tabName === 'setup') {
                setTimeout(() => refreshDeviceStatus(), 300);
            }
        };
        
        // Initial data request
        socket.emit('request_data', { type: 'kpis' });
        socket.emit('request_data', { type: 'cellular' });
        socket.emit('request_data', { type: 'health' });
        socket.emit('request_data', { type: 'exploits' });
        socket.emit('request_data', { type: 'analytics' });
        socket.emit('request_data', { type: 'ntn' });
        socket.emit('request_data', { type: 'agents' });
        socket.emit('request_data', { type: 'emissions' });
        socket.emit('request_data', { type: 'sdr' });
        socket.emit('request_data', { type: 'targets' });
        socket.emit('request_data', { type: 'config' });
        socket.emit('request_data', { type: 'regulatory' });
        socket.emit('request_data', { type: 'quick_status' });
        
        // Initial v1.7.0 data load
        updateV170Panels();
        
        // ==================== EXPLOIT MANAGEMENT FUNCTIONS ====================
        
        // Help modal system
        function showExploitHelp(exploitType = null) {
            if (!exploitType) {
                // Show general help
                alert('Exploit Control Center\n\nSelect an exploit type and attack to view detailed help and parameters.\n\nClick the Help button on each exploit panel for specific information.');
                return;
            }
            
            // Fetch exploit help from API
            fetch(`/api/exploits/help/${exploitType}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayExploitHelp(data.documentation);
                    } else {
                        alert('Error loading help: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Help fetch error:', error);
                    alert('Failed to load help documentation');
                });
        }
        
        function displayExploitHelp(doc) {
            const modal = createModal();
            let html = `
                <div style="max-width: 900px; margin: auto; padding: 20px;">
                    <h2 style="color: #00e5ff;">${doc.name}</h2>
                    <p style="font-size: 16px; margin-bottom: 20px;">${doc.description}</p>
                    <p style="color: #ffa500; margin-bottom: 20px;"><strong>‚ö†Ô∏è ${doc.general_info}</strong></p>
            `;
            
            // List all attacks
            html += '<h3 style="color: #00e5ff; margin-top: 20px;">Available Attacks:</h3>';
            for (const [attackId, attack] of Object.entries(doc.attacks)) {
                html += `
                    <div style="background: rgba(0,229,255,0.1); padding: 15px; margin: 10px 0; border-radius: 5px;">
                        <h4 style="margin-top: 0;">${attack.name}</h4>
                        <p>${attack.description}</p>
                        <div style="margin-top: 10px;">
                            <strong>Parameters:</strong>
                            <ul style="margin-top: 5px;">
                `;
                
                for (const param of attack.parameters) {
                    const required = param.required ? ' (Required)' : '';
                    const defaultVal = param.default !== undefined ? ` [Default: ${param.default}]` : '';
                    html += `<li><code>${param.name}</code> (${param.type})${required}${defaultVal} - ${param.description || ''}</li>`;
                }
                
                html += `
                            </ul>
                        </div>
                        <p style="margin-top: 10px;"><strong>Risks:</strong> <span style="color: #ff4444;">${attack.risks}</span></p>
                        <p><strong>Requirements:</strong> ${attack.requirements}</p>
                        <p><strong>Estimated Time:</strong> ${attack.estimated_time}</p>
                    </div>
                `;
            }
            
            html += '</div>';
            modal.innerHTML = html;
        }
        
        function createModal() {
            // Create modal overlay
            let modal = document.getElementById('exploit-help-modal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'exploit-help-modal';
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.9);
                    z-index: 10000;
                    overflow-y: auto;
                    padding: 20px;
                `;
                
                modal.onclick = function(e) {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                    }
                };
                
                document.body.appendChild(modal);
            }
            
            return modal;
        }
        
        // Dynamic form generation for each exploit type
        function updateCryptoForm(attackType) {
            const container = document.getElementById('crypto-form-container');
            if (!attackType) {
                container.innerHTML = '';
                return;
            }
            
            let html = '<div class="form-params">';
            
            if (attackType === 'a5_1_crack') {
                html += `
                    <div class="form-group">
                        <label>Target IMSI: <span style="color: red;">*</span></label>
                        <input type="text" id="crypto-target-imsi" class="form-control" placeholder="e.g., 123456789012345" required>
                    </div>
                    <div class="form-group">
                        <label>Frame Count:</label>
                        <input type="number" id="crypto-frame-count" class="form-control" value="1000">
                    </div>
                    <div class="form-group">
                        <label>Rainbow Table:</label>
                        <select id="crypto-rainbow-table" class="form-control">
                            <option value="standard">Standard</option>
                            <option value="extended">Extended</option>
                        </select>
                    </div>
                `;
            } else if (attackType === 'kasumi_attack') {
                html += `
                    <div class="form-group">
                        <label>Target IMSI: <span style="color: red;">*</span></label>
                        <input type="text" id="crypto-target-imsi" class="form-control" placeholder="e.g., 123456789012345" required>
                    </div>
                    <div class="form-group">
                        <label>Algorithm:</label>
                        <select id="crypto-algorithm" class="form-control">
                            <option value="KASUMI">KASUMI</option>
                            <option value="SNOW3G">SNOW 3G</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Attack Mode:</label>
                        <select id="crypto-attack-mode" class="form-control">
                            <option value="known_plaintext">Known Plaintext</option>
                            <option value="chosen_plaintext">Chosen Plaintext</option>
                        </select>
                    </div>
                `;
            } else if (attackType === 'suci_deconcealment') {
                html += `
                    <div class="form-group">
                        <label>SUCI Value: <span style="color: red;">*</span></label>
                        <input type="text" id="crypto-suci" class="form-control" placeholder="Enter captured SUCI" required>
                    </div>
                    <div class="form-group">
                        <label>Protection Scheme:</label>
                        <select id="crypto-protection-scheme" class="form-control">
                            <option value="Profile_A">Profile A</option>
                            <option value="Profile_B">Profile B</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="crypto-use-ml" checked> Use ML-Assisted Deconcealment
                        </label>
                    </div>
                `;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        function updateNtnForm(attackType) {
            const container = document.getElementById('ntn-form-container');
            if (!attackType) {
                container.innerHTML = '';
                return;
            }
            
            let html = '<div class="form-params">';
            
            if (attackType === 'satellite_hijack') {
                html += `
                    <div class="form-group">
                        <label>Satellite ID: <span style="color: red;">*</span></label>
                        <input type="text" id="ntn-satellite-id" class="form-control" placeholder="e.g., SAT-123" required>
                    </div>
                    <div class="form-group">
                        <label>Frequency (MHz): <span style="color: red;">*</span></label>
                        <input type="number" step="0.01" id="ntn-frequency" class="form-control" placeholder="e.g., 2100.5" required>
                    </div>
                    <div class="form-group">
                        <label>Beam ID:</label>
                        <input type="number" id="ntn-beam-id" class="form-control" placeholder="Optional">
                    </div>
                    <div class="form-group">
                        <label>Mode:</label>
                        <select id="ntn-mode" class="form-control">
                            <option value="monitor">Monitor Only</option>
                            <option value="active">Active Injection</option>
                        </select>
                    </div>
                `;
            } else if (attackType === 'iot_ntn_exploit') {
                html += `
                    <div class="form-group">
                        <label>Device Type: <span style="color: red;">*</span></label>
                        <select id="ntn-device-type" class="form-control" required>
                            <option value="sensor">Sensor</option>
                            <option value="tracker">Tracker</option>
                            <option value="meter">Smart Meter</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Target Identifier: <span style="color: red;">*</span></label>
                        <input type="text" id="ntn-target-id" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Exploit Type:</label>
                        <select id="ntn-exploit-type" class="form-control">
                            <option value="intercept">Intercept</option>
                            <option value="dos">Denial of Service</option>
                            <option value="inject">Message Injection</option>
                        </select>
                    </div>
                `;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        function updateV2xForm(attackType) {
            const container = document.getElementById('v2x-form-container');
            if (!attackType) {
                container.innerHTML = '';
                return;
            }
            
            let html = '<div class="form-params">';
            
            if (attackType === 'c_v2x_jam') {
                html += `
                    <div class="form-group">
                        <label>Frequency (MHz):</label>
                        <input type="number" step="0.1" id="v2x-frequency" class="form-control" value="5900.0">
                    </div>
                    <div class="form-group">
                        <label>Power (dBm):</label>
                        <input type="number" id="v2x-power" class="form-control" value="20">
                    </div>
                    <div class="form-group">
                        <label>Range (meters):</label>
                        <input type="number" id="v2x-range" class="form-control" value="300">
                    </div>
                `;
            } else if (attackType === 'message_injection') {
                html += `
                    <div class="form-group">
                        <label>Message Type: <span style="color: red;">*</span></label>
                        <select id="v2x-message-type" class="form-control" required>
                            <option value="BSM">Basic Safety Message (BSM)</option>
                            <option value="DENM">Decentralized Environmental Notification (DENM)</option>
                            <option value="CAM">Cooperative Awareness Message (CAM)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Payload: <span style="color: red;">*</span></label>
                        <textarea id="v2x-payload" class="form-control" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Repetition Interval (ms):</label>
                        <input type="number" id="v2x-repetition" class="form-control" value="100">
                    </div>
                `;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        function updateMsgForm(attackType) {
            const container = document.getElementById('msg-form-container');
            if (!attackType) {
                container.innerHTML = '';
                return;
            }
            
            let html = '<div class="form-params">';
            
            if (attackType === 'silent_sms') {
                html += `
                    <div class="form-group">
                        <label>Target Phone Number: <span style="color: red;">*</span></label>
                        <input type="text" id="msg-target-msisdn" class="form-control" placeholder="+1234567890" required>
                    </div>
                    <div class="form-group">
                        <label>Message Count:</label>
                        <input type="number" id="msg-count" class="form-control" value="1">
                    </div>
                    <div class="form-group">
                        <label>Interval (seconds):</label>
                        <input type="number" id="msg-interval" class="form-control" value="300">
                    </div>
                `;
            } else if (attackType === 'fake_emergency') {
                html += `
                    <div class="form-group">
                        <label>Alert Type: <span style="color: red;">*</span></label>
                        <select id="msg-alert-type" class="form-control" required>
                            <option value="earthquake">Earthquake</option>
                            <option value="tsunami">Tsunami</option>
                            <option value="storm">Severe Storm</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Area Code: <span style="color: red;">*</span></label>
                        <input type="text" id="msg-area-code" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Message Text: <span style="color: red;">*</span></label>
                        <textarea id="msg-text" class="form-control" rows="3" required></textarea>
                    </div>
                `;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        function updateDowngradeForm(attackType) {
            const container = document.getElementById('downgrade-form-container');
            if (!attackType) {
                container.innerHTML = '';
                return;
            }
            
            let html = '<div class="form-params">';
            
            if (attackType === 'lte_to_3g') {
                html += `
                    <div class="form-group">
                        <label>Target IMSI: <span style="color: red;">*</span></label>
                        <input type="text" id="downgrade-target-imsi" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Target Generation:</label>
                        <select id="downgrade-target-gen" class="form-control">
                            <option value="3G">3G (UMTS)</option>
                            <option value="2G">2G (GSM)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Fake PLMN:</label>
                        <input type="text" id="downgrade-plmn" class="form-control" placeholder="Optional">
                    </div>
                `;
            } else if (attackType === 'fiveg_security_downgrade') {
                html += `
                    <div class="form-group">
                        <label>Target SUCI: <span style="color: red;">*</span></label>
                        <input type="text" id="downgrade-target-suci" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Target Algorithm:</label>
                        <select id="downgrade-algorithm" class="form-control">
                            <option value="NEA0">NEA0 (No Encryption)</option>
                            <option value="NEA1">NEA1 (SNOW 3G)</option>
                            <option value="NEA2">NEA2 (AES)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="downgrade-integrity"> Disable Integrity Protection
                        </label>
                    </div>
                `;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        function updatePagingForm(attackType) {
            const container = document.getElementById('paging-form-container');
            if (!attackType) {
                container.innerHTML = '';
                return;
            }
            
            let html = '<div class="form-params">';
            
            if (attackType === 'paging_scan') {
                html += `
                    <div class="form-group">
                        <label>Frequency (MHz): <span style="color: red;">*</span></label>
                        <input type="number" step="0.01" id="paging-frequency" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Bandwidth (MHz):</label>
                        <input type="number" step="0.1" id="paging-bandwidth" class="form-control" value="10.0">
                    </div>
                    <div class="form-group">
                        <label>Duration (minutes):</label>
                        <input type="number" id="paging-duration" class="form-control" value="60">
                    </div>
                `;
            } else if (attackType === 'paging_storm') {
                html += `
                    <div class="form-group">
                        <label>Target Cell ID: <span style="color: red;">*</span></label>
                        <input type="text" id="paging-cell-id" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Paging Rate (per second):</label>
                        <input type="number" id="paging-rate" class="form-control" value="1000">
                    </div>
                    <div class="form-group">
                        <label>Duration (seconds):</label>
                        <input type="number" id="paging-attack-duration" class="form-control" value="60">
                    </div>
                `;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        function updateAiotForm(attackType) {
            const container = document.getElementById('aiot-form-container');
            if (!attackType) {
                container.innerHTML = '';
                return;
            }
            
            let html = '<div class="form-params">';
            
            if (attackType === 'aiot_poisoning') {
                html += `
                    <div class="form-group">
                        <label>Device ID: <span style="color: red;">*</span></label>
                        <input type="text" id="aiot-device-id" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Model Type: <span style="color: red;">*</span></label>
                        <select id="aiot-model-type" class="form-control" required>
                            <option value="image">Image Recognition</option>
                            <option value="audio">Audio Processing</option>
                            <option value="sensor">Sensor Data</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Adversarial Method:</label>
                        <select id="aiot-adv-method" class="form-control">
                            <option value="FGSM">FGSM</option>
                            <option value="PGD">PGD</option>
                            <option value="C&W">Carlini & Wagner</option>
                        </select>
                    </div>
                `;
            } else if (attackType === 'federated_manipulation') {
                html += `
                    <div class="form-group">
                        <label>Target Network: <span style="color: red;">*</span></label>
                        <input type="text" id="aiot-target-network" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Manipulation Type:</label>
                        <select id="aiot-manip-type" class="form-control">
                            <option value="gradient">Gradient Manipulation</option>
                            <option value="model">Model Poisoning</option>
                            <option value="data">Data Poisoning</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Scale Factor:</label>
                        <input type="number" step="0.1" id="aiot-scale-factor" class="form-control" value="10.0">
                    </div>
                `;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        function updateSemanticForm(attackType) {
            const container = document.getElementById('semantic-form-container');
            if (!attackType) {
                container.innerHTML = '';
                return;
            }
            
            let html = '<div class="form-params">';
            
            if (attackType === 'semantic_injection') {
                html += `
                    <div class="form-group">
                        <label>Target Session: <span style="color: red;">*</span></label>
                        <input type="text" id="semantic-target-session" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Semantic Vector: <span style="color: red;">*</span></label>
                        <textarea id="semantic-vector" class="form-control" rows="3" placeholder="Enter semantic embedding" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Confidence Score:</label>
                        <input type="number" step="0.01" min="0" max="1" id="semantic-confidence" class="form-control" value="0.95">
                    </div>
                `;
            } else if (attackType === 'knowledge_graph_poisoning') {
                html += `
                    <div class="form-group">
                        <label>Target Knowledge Graph: <span style="color: red;">*</span></label>
                        <input type="text" id="semantic-target-kg" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>False Relations (JSON): <span style="color: red;">*</span></label>
                        <textarea id="semantic-false-relations" class="form-control" rows="4" placeholder='{"entity1": "relation", "entity2": "value"}' required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Propagation Mode:</label>
                        <select id="semantic-propagation" class="form-control">
                            <option value="indirect">Indirect</option>
                            <option value="direct">Direct</option>
                        </select>
                    </div>
                `;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // Execute exploit
        function runExploit(exploitType) {
            // Get selected attack type
            const attackSelect = document.getElementById(`${exploitType === 'crypto' ? 'crypto' : exploitType === 'ntn' ? 'ntn' : exploitType === 'v2x' ? 'v2x' : exploitType === 'message_injection' ? 'msg' : exploitType === 'downgrade' ? 'downgrade' : exploitType === 'paging' ? 'paging' : exploitType === 'aiot' ? 'aiot' : 'semantic'}-attack-type`);
            const attackName = attackSelect ? attackSelect.value : '';
            
            if (!attackName) {
                alert('Please select an attack type first');
                return;
            }
            
            // Collect parameters based on exploit type
            const parameters = collectExploitParameters(exploitType, attackName);
            
            if (!parameters) {
                return; // Validation failed
            }
            
            // Get target ID from targets list (for now, use 'default')
            const targetId = 'default';
            
            // Send exploit request
            fetch('/api/exploits/run', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    exploit_type: exploitType,
                    attack_name: attackName,
                    target_id: targetId,
                    parameters: parameters
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(`Exploit started successfully!\n\nOperation ID: ${data.operation_id}\nEstimated Duration: ${data.estimated_duration}\n\nMonitor progress in the results panel.`);
                    monitorExploitProgress(data.operation_id);
                } else {
                    alert('Exploit failed to start: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Exploit execution error:', error);
                alert('Failed to execute exploit');
            });
        }
        
        function collectExploitParameters(exploitType, attackName) {
            // This would collect all parameters from the form
            // For brevity, returning a basic object
            const params = {};
            
            // Get all inputs in the form container
            const container = document.getElementById(`${exploitType}-form-container`);
            if (!container) return {};
            
            const inputs = container.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    params[input.id.replace(`${exploitType}-`, '')] = input.checked;
                } else {
                    params[input.id.replace(`${exploitType}-`, '')] = input.value;
                }
            });
            
            return params;
        }
        
        function monitorExploitProgress(operationId) {
            // Poll for operation status
            const checkStatus = () => {
                fetch(`/api/exploits/status/${operationId}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            const status = data.status;
                            // Update UI with progress
                            console.log('Exploit progress:', status.progress + '%');
                            
                            if (status.status === 'running') {
                                setTimeout(checkStatus, 2000); // Check again in 2 seconds
                            }
                        }
                    });
            };
            
            checkStatus();
        }
        
        function stopAllExploits(exploitType) {
            if (!confirm(`Stop all running ${exploitType} exploits?`)) {
                return;
            }
            
            // In production, would get all active operation IDs for this type
            alert('Stop functionality will be implemented to stop all active operations');
        }
        
        function runSecurityAudit() {
            const auditType = document.getElementById('audit-type').value;
            const targetId = document.getElementById('audit-target').value;
            const auditDepth = document.getElementById('audit-depth').value;
            
            if (!targetId) {
                alert('Please enter a target ID');
                return;
            }
            
            alert(`Starting ${auditDepth} security audit on target ${targetId}...\n\nThis may take several minutes.`);
            
            // Call audit API
            runExploit('security_audit');
        }
        
        function refreshExploitHistory() {
            fetch('/api/exploits/history?limit=50')
                .then(response => response.json())
                .then(data => {
                    displayExploitHistory(data);
                })
                .catch(error => {
                    console.error('History fetch error:', error);
                });
        }
        
        function displayExploitHistory(data) {
            const modal = createModal();
            let html = `
                <div style="max-width: 1200px; margin: auto; padding: 20px; background: #1a1a2e; border-radius: 10px;">
                    <h2 style="color: #00e5ff;">Exploit Execution History</h2>
                    <div style="margin: 20px 0;">
                        <strong>Total Operations:</strong> ${data.statistics.total} | 
                        <strong style="color: #4CAF50;">Successful:</strong> ${data.statistics.successful} | 
                        <strong style="color: #f44336;">Failed:</strong> ${data.statistics.failed} | 
                        <strong style="color: #ff9800;">Stopped:</strong> ${data.statistics.stopped}
                    </div>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <tr style="background: rgba(0,229,255,0.2);">
                            <th style="padding: 10px; border: 1px solid #00e5ff;">Time</th>
                            <th style="padding: 10px; border: 1px solid #00e5ff;">Type</th>
                            <th style="padding: 10px; border: 1px solid #00e5ff;">Attack</th>
                            <th style="padding: 10px; border: 1px solid #00e5ff;">Status</th>
                            <th style="padding: 10px; border: 1px solid #00e5ff;">Duration</th>
                        </tr>
            `;
            
            data.operations.forEach(op => {
                const duration = op.end_time ? ((op.end_time - op.start_time) / 60).toFixed(1) + ' min' : 'Running...';
                const statusColor = op.status === 'completed' ? '#4CAF50' : op.status === 'failed' ? '#f44336' : '#ff9800';
                html += `
                    <tr>
                        <td style="padding: 8px; border: 1px solid #444;">${new Date(op.start_time * 1000).toLocaleString()}</td>
                        <td style="padding: 8px; border: 1px solid #444;">${op.exploit_type}</td>
                        <td style="padding: 8px; border: 1px solid #444;">${op.attack_name}</td>
                        <td style="padding: 8px; border: 1px solid #444; color: ${statusColor};">${op.status}</td>
                        <td style="padding: 8px; border: 1px solid #444;">${duration}</td>
                    </tr>
                `;
            });
            
            html += `
                    </table>
                    <button onclick="document.body.removeChild(document.getElementById('exploit-help-modal'))" 
                            style="margin-top: 20px; padding: 10px 20px; background: #00e5ff; border: none; border-radius: 5px; cursor: pointer;">
                        Close
                    </button>
                </div>
            `;
            
            modal.innerHTML = html;
        }
        
        function exportExploitResults() {
            const format = prompt('Export format (json/csv):', 'json');
            if (!format) return;
            
            alert(`Exporting exploit results as ${format}...\n\nFile will be saved to ./exports/ directory.`);
            
            fetch('/api/exploits/export', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    operation_ids: [],  // Empty means all
                    format: format
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(`Export successful!\n\nFile: ${data.filename}\nOperations: ${data.operations_count}`);
                } else {
                    alert('Export failed: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Export error:', error);
                alert('Export failed');
            });
        }
    </script>
</body>
</html>